<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나는 어떤 곤충상일까? - 곤충상 테스트</title>
    <meta name="description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <link rel="canonical" href="https://anse-sample1.pages.dev/insect.html">

    <meta property="og:title" content="나는 어떤 곤충상일까? - 곤충상 테스트">
    <meta property="og:description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anse-sample1.pages.dev/insect.html">
    <meta property="og:image" content="https://anse-sample1.pages.dev/favicon.svg">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="나는 어떤 곤충상일까? - 곤충상 테스트">
    <meta property="twitter:description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <meta property="twitter:image" content="https://anse-sample1.pages.dev/favicon.svg">

    <link rel="stylesheet" href="style.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>
    <link rel="icon" type="image/x-icon" href="fa.ico">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C8QR98TVTB');
</script>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v2qmp0i82b");
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "곤충상 테스트",
      "url": "https://anse-sample1.pages.dev/insect.html",
      "description": "AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.",
      "applicationCategory": "Entertainment",
      "operatingSystem": "Any",
      "browserRequirements": "Requires HTML5 support"
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        .image-preview-container {
            max-width: 100%; /* Max width */
            width: 30em; /* Responsive width */
            height: auto; /* Maintain aspect ratio */
            margin: 20px auto; /* Center the image preview */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px var(--shadow-color);
            display: flex; /* Use flexbox to center image vertically/horizontally */
            justify-content: center;
            align-items: center;
            background-color: var(--background-light-start); /* Placeholder background */
        }
        .image-preview-container img {
            max-width: 100%; /* Ensure image fits container */
            max-height: 100%;
            object-fit: contain; /* Contain the entire image */
            display: block;
        }
        .prediction-graph {
            margin-top: 30px;
            width: 100%;
            max-width: 500px;
            text-align: left;
            margin-left: auto;
            margin-right: auto;
        }
        .prediction-bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: var(--text-color-dark);
        }
        .prediction-bar-label {
            flex-basis: 120px;
            margin-right: 10px;
            font-weight: bold;
        }
        .prediction-bar {
            flex-grow: 1;
            height: 20px;
            background-color: var(--prediction-bar-background);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        .prediction-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--light-green), var(--primary-green));
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 5px;
            color: var(--text-color-dark);
            font-size: 0.8em;
            box-sizing: border-box;
        }
        .insect-features {
            margin-top: 30px;
            text-align: left;
            padding: 20px;
            background-color: var(--background-light-start);
            border-radius: 10px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        .insect-features h3 {
            text-align: center;
            color: var(--dark-green);
        }
        .insect-features p {
            font-size: 1em;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <header class="container">
        <div class="theme-switcher-container">
            <button id="theme-switcher">Toggle Theme</button>
        </div>
        <h1><a href="/">오늘 저녁 뭐 먹지?</a></h1>
        <nav>
            <a href="/insect.html">곤충상 테스트</a>
            <a href="/about-insect.html">곤충상이란?</a>
        </nav>
    </header>

    <main class="container">
        <article>
            <h2>나는 어떤 곤충상일까?</h2>
            <p>AI가 당신의 얼굴 사진을 분석하여 당신의 곤충상을 찾아드립니다. 지금 바로 테스트해보세요!</p>
            
            <div class="button-group">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button onclick="document.getElementById('imageUpload').click()">사진 업로드</button>
                <button id="checkResult" style="margin-left: 10px;">결과 확인하기</button>
            </div>
            
            <div id="imagePreview" class="image-preview-container">
                <!-- Uploaded image preview will be displayed here -->
            </div>

            <div id="result" style="margin-top: 20px; font-size: 1.8em; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">
                여기에 결과가 표시됩니다.
            </div>
            <p style="text-align: center; font-size: 0.9em; color: var(--text-color-dark); margin-top: 10px;">사진은 저장되지 않습니다.</p>


            <div id="predictionGraph" class="prediction-graph">
                <!-- Prediction graph will be displayed here -->
            </div>

            <div id="insectFeatures" class="insect-features" style="display: none;">
                <!-- Insect features will be displayed here -->
            </div>
        </article>
    </main>

    <div class="contact-section">
        <h2>제휴 문의</h2>
        <form action="https://formspree.io/f/mlggrwrk" method="POST">
            <input type="text" name="name" placeholder="이름" required>
            <input type="email" name="email" placeholder="이메일" required>
            <textarea name="message" placeholder="내용" required></textarea>
            <button type="submit">보내기</button>
        </form>
    </div>

    <div id="disqus_thread"></div>

    <footer class="container">
        <p>Last updated: 2026년 1월 17일</p>
        <p><a href="/privacy.html">개인정보처리방침</a></p>
    </footer>

    <script src="main.js"></script>
    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/_oRwiza95/";
        let model, maxPredictions;

        const insectDescriptions = {
            "개미": "부지런하고 협동심이 강한 인상을 줍니다. 목표 지향적이고 현실적인 성향을 가집니다.",
            "벌": "활발하고 에너지가 넘치며, 리더십 있는 모습을 보입니다. 사회성이 뛰어나고 책임감이 강합니다.",
            "나비": "아름답고 섬세하며, 자유로운 영혼을 가진 인상을 줍니다. 예술적 감각이 뛰어나고 변화를 즐깁니다.",
            "사마귀": "날카롭고 카리스마 있는 인상을 줍니다. 집중력이 좋고 목표를 향해 끈기 있게 나아가는 성향이 있습니다.",
            "무당벌래": "귀엽고 친근하며, 긍정적인 에너지를 발산합니다. 주변 사람들에게 행복을 주는 유쾌한 성격입니다.",
            "장수풍뎅이": "튼튼하고 묵직한 인상을 주며, 강인함과 안정감을 가집니다. 신뢰할 수 있고 든든한 타입입니다."
        };

        // Load the image model
        async function initModel() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                console.log("Teachable Machine model loaded successfully.");
            } catch (error) {
                console.error("Failed to load Teachable Machine model:", error);
                document.getElementById('result').textContent = '모델 로드 실패. 콘솔을 확인하세요.';
            }
        }

        // Call initModel when the window loads
        window.addEventListener('load', initModel);

        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    document.getElementById('imagePreview').innerHTML = '';
                    document.getElementById('imagePreview').appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('checkResult').addEventListener('click', async function() {
            const resultDiv = document.getElementById('result');
            const imagePreviewDiv = document.getElementById('imagePreview');
            const uploadedImageElement = imagePreviewDiv.querySelector('img');
            const predictionGraphDiv = document.getElementById('predictionGraph');
            const insectFeaturesDiv = document.getElementById('insectFeatures');

            predictionGraphDiv.innerHTML = ''; // Clear previous graph
            insectFeaturesDiv.innerHTML = ''; // Clear previous features
            insectFeaturesDiv.style.display = 'none'; // Hide features initially

            if (!uploadedImageElement) {
                resultDiv.textContent = '사진을 먼저 업로드해주세요!';
                return;
            }

            if (!model) {
                resultDiv.textContent = 'AI 모델 로딩 중입니다. 잠시 후 다시 시도해주세요.';
                await initModel(); 
                if (!model) {
                    resultDiv.textContent = 'AI 모델 로드에 실패했습니다. 페이지를 새로고침하거나 나중에 다시 시도해주세요.';
                    return;
                }
            }

            resultDiv.textContent = 'AI가 당신의 곤충상을 분석 중입니다...';

            try {
                // Create a canvas from the uploaded image for prediction
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                // Ensure canvas size matches the model's expected input size (e.g., 224x224 from Teachable Machine defaults)
                const modelInputSize = 224; 
                canvas.width = modelInputSize;
                canvas.height = modelInputSize;
                ctx.drawImage(uploadedImageElement, 0, 0, modelInputSize, modelInputSize);


                const prediction = await model.predict(canvas);
                
                let highestProbability = 0;
                let predictedInsect = '알 수 없음';

                // Display graph and find highest probability
                prediction.forEach(p => {
                    const barContainer = document.createElement('div');
                    barContainer.className = 'prediction-bar-container';

                    const labelSpan = document.createElement('span');
                    labelSpan.className = 'prediction-bar-label';
                    labelSpan.textContent = p.className;

                    const barOuter = document.createElement('div');
                    barOuter.className = 'prediction-bar';

                    const barFill = document.createElement('div');
                    barFill.className = 'prediction-bar-fill';
                    barFill.style.width = `${p.probability * 100}%`;
                    barFill.textContent = `${(p.probability * 100).toFixed(1)}%`;

                    barOuter.appendChild(barFill);
                    barContainer.appendChild(labelSpan);
                    barContainer.appendChild(barOuter);
                    predictionGraphDiv.appendChild(barContainer);

                    if (p.probability > highestProbability) {
                        highestProbability = p.probability;
                        predictedInsect = p.className;
                    }
                });
                
                resultDiv.textContent = `당신은 ${predictedInsect}입니다!`;

                // Display insect features
                const description = insectDescriptions[predictedInsect] || "해당 곤충상에 대한 설명이 없습니다.";
                insectFeaturesDiv.innerHTML = `<h3>${predictedInsect} 특징</h3><p>${description}</p>`;
                insectFeaturesDiv.style.display = 'block';

            } catch (error) {
                console.error("Prediction failed:", error);
                resultDiv.textContent = '분석 중 오류가 발생했습니다. 콘솔을 확인하세요.';
            }
        });
        
        // Disqus configuration (remains unchanged)
        var disqus_config = function () {
            this.page.url = 'https://anse-sample1.pages.dev/insect.html';
            this.page.identifier = 'https://anse-sample1.pages.dev/insect.html';
        };
        (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://ansebooktv.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</body>
</html>