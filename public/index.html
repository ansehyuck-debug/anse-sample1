<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-i18n="title-korea">KOSPI 공포 탐욕 지수 - 코스피 시장 심리 및 AI 지표 분석 | anse.ai.kr</title>
<meta name="description" content="코스피(KOSPI)의 모멘텀, 주가 강도, 시장 폭, 변동성, 옵션 비율을 종합 분석하여 일일 공포 탐욕 지수를 제공합니다. anse.ai.kr의 AI 모델이 분석한 시장 리포트를 확인하세요." data-i18n="desc-korea"/>
<link rel="canonical" href="https://anse.ai.kr/"/>
<link rel="alternate" hreflang="ko" href="https://anse.ai.kr/" />
<link rel="alternate" hreflang="en" href="https://anse.ai.kr/" />
<link rel="alternate" hreflang="x-default" href="https://anse.ai.kr/" />

<!-- Structured Data for GEO (AI Search Optimization) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FinancialReport",
  "name": "KOSPI Fear & Greed Index Analysis",
  "description": "Daily analysis of Korea stock market sentiment using KOSPI momentum, volatility, and option data.",
  "publisher": {
    "@type": "Organization",
    "name": "anse.ai.kr",
    "logo": {
      "@type": "ImageObject",
      "url": "https://anse.ai.kr/images/neutral.png"
    }
  },
  "sourceOrganization": [
    {
      "@type": "Organization",
      "name": "KRX (Korea Exchange)"
    },
    {
      "@type": "Organization",
      "name": "KOFIA (Korea Financial Investment Association)"
    }
  ],
  "about": {
    "@type": "Thing",
    "name": "KOSPI Market Sentiment"
  }
}
</script>

<!-- Open Graph / Facebook -->
<meta property="og:site_name" content="anse.ai.kr - 주식 시장 심리 분석"/>
<meta property="og:title" content="KOSPI 공포 탐욕 지수 - 코스피 시장 심리 및 AI 지표 분석" data-i18n="title-korea"/>
<meta property="og:description" content="일일 업데이트되는 KOSPI 공포 탐욕 지수와 AI 시장 분석 리포트를 확인하세요." data-i18n="desc-korea"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://anse.ai.kr/"/>
<meta property="og:image" content="https://anse.ai.kr/images/anse_ai_kr.png"/>
<meta name="author" content="anse.ai.kr"/>

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="KOSPI 공포 탐욕 지수 - 코스피 시장 심리 및 AI 지표 분석" data-i18n="title-korea"/>
<meta name="twitter:description" content="일일 업데이트되는 KOSPI 공포 탐욕 지수와 AI 시장 분석 리포트를 확인하세요." data-i18n="desc-korea"/>
<meta name="twitter:image" content="https://anse.ai.kr/images/anse_ai_kr.png"/>

<link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="translations.js"></script>
<script src="proverbs.js"></script>
<script src="i18n.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3d84f5",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101722",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'OPSZ' 24; }
        .gauge-gradient {
            background: conic-gradient(from 180deg at 50% 100%, #f87171 0deg, #fbbf24 90deg, #3d84f5 180deg);
        }
        html[lang="ko"] .lang-en { display: none !important; }
        html[lang="en"] .lang-ko { display: none !important; }
    </style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C8QR98TVTB');
    </script>
</head>
<body class="min-h-screen bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-200">
    <div id="header-placeholder"></div>

<main class="mx-auto max-w-[1200px] px-6 py-8">
<!-- Page Heading -->
<div class="mb-8 flex flex-wrap items-end justify-between gap-8">
<div class="flex flex-col gap-1">
<h1 class="text-3xl font-black tracking-tight dark:text-white" data-i18n="market-sentiment-index">Market Sentiment Index</h1>
<p class="text-base text-[#49699c] dark:text-slate-400" data-i18n="kospi-analysis-desc">KOSPI fear and greed analysis based on market momentum and volatility.</p>
</div>
<div id="market-status-indicator" class="flex items-center gap-2 rounded-full bg-slate-100 dark:bg-slate-800 px-6 py-2 text-xs font-bold text-slate-600 dark:text-slate-400">
    <span id="market-status-dot" class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
    <span id="market-status-text" data-i18n="updating">Updating...</span>
</div>
</div>

<div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
<!-- Main Gauge Section -->
<div class="lg:col-span-8">
<div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
<div class="mb-4 flex flex-wrap items-center justify-between gap-3">
<h3 class="text-lg font-bold" data-i18n="current-sentiment">Current Sentiment</h3>
<span id="last-updated-time" class="text-sm font-medium text-[#49699c]"><span data-i18n="last-updated">마지막 업데이트</span>: --:--</span>
</div>
<div class="relative flex flex-col items-center py-10" role="img" aria-label="KOSPI Fear and Greed Index Gauge">
<!-- Gauge visualization -->
<div class="relative h-48 w-80 overflow-hidden rounded-t-full bg-slate-100 dark:bg-slate-800">
<div class="absolute inset-0 gauge-gradient opacity-80" aria-hidden="true"></div>
<div class="absolute bottom-0 left-1/2 h-32 w-64 -translate-x-1/2 rounded-t-full bg-white dark:bg-[#161f2c]" aria-hidden="true"></div>
<!-- Needle -->
<div class="absolute bottom-0 left-1/2 h-40 w-1 -translate-x-1/2 origin-bottom transition-transform duration-1000 ease-out" id="gauge-needle" style="transform: translateX(-50%) rotate(-90deg);">
<div class="h-full w-full bg-slate-900 dark:bg-white rounded-full"></div>
<div class="absolute -bottom-2 left-1/2 h-4 w-4 -translate-x-1/2 rounded-full bg-slate-900 dark:bg-white"></div>
</div>
</div>
<div class="mt-6 flex flex-col items-center gap-1">
<span id="score" class="text-5xl font-black text-primary">--</span>
<span id="status" class="text-2xl font-bold tracking-tight text-primary">NEUTRAL</span>
</div>
<div class="mt-10 flex flex-wrap w-full justify-between px-4 gap-3">
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-red-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-fear">Extreme Fear</span>
</div>
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-yellow-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="neutral">Neutral</span>
</div>
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-primary"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-greed">Extreme Greed</span>
</div>
</div>
</div>
</div>

<!-- Index Advisors -->
<div class="mt-8 flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
<div class="mb-6 flex items-center justify-between gap-2">
<h3 class="text-lg font-bold" data-i18n="index-advisors">Index Advisors</h3>
<div class="flex flex-wrap gap-2 justify-end">
<button id="advisor-gemini" class="rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary">Gemini</button>
<button id="advisor-gpt" class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">GPT</button>
<button id="advisor-grok" class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Grok</button>
</div>
</div>
<div id="advisor-advice-display" class="min-h-[200px] flex flex-col justify-center">
    <p class="text-sm dark:text-slate-200 text-center" data-i18n="updating">Loading Advisor Advice...</p>
</div>
</div>
</div>

<!-- Sidebar -->
<div class="lg:col-span-4 flex flex-col gap-6">
<!-- Proverbs -->
<div class="flex flex-col gap-4 rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
    <h4 class="text-sm font-bold text-[#49699c] uppercase tracking-wider mb-2" data-i18n="today-proverb">오늘의 주식 시장 격언</h4>
    <p id="proverb-text" class="italic text-base text-gray-800 dark:text-gray-200 min-h-[60px] flex items-center justify-center text-center break-keep" style="white-space: pre-wrap;"></p>
    <button id="generate-proverb" class="mt-2 rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary hover:bg-primary/20 transition-colors" data-i18n="new-proverb">새 격언 확인하기</button>
</div>

<!-- Market Indicators -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
    <h4 class="mb-4 text-sm font-bold text-[#49699c] uppercase tracking-wider" data-i18n="market-indicators">Market Indicators</h4>
    <div id="dynamic-indicators-container" class="space-y-4">
        <p class="text-xs text-slate-400">Loading indicators...</p>
    </div>
    <div class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-800">
        <p class="text-[10px] text-[#49699c] dark:text-slate-500" data-i18n="footer-desc-korea">Data provided by KRX and KOFIA.</p>
    </div>
</div>

<!-- KOSPI Quick View -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-primary text-white p-6 shadow-sm">
<div class="flex items-center justify-between mb-4">
<h4 class="text-sm font-bold uppercase tracking-wider">KOSPI</h4>
<a href="https://finance.naver.com/sise/" target="_blank"><span class="material-symbols-outlined text-white">insights</span></a>
</div>
<div class="flex flex-col gap-1">
<p id="kospi-value" class="text-3xl font-black">----.--</p>
<div class="flex items-center gap-2">
<span id="kospi-change-rate" class="text-sm font-bold bg-white/20 px-2 py-0.5 rounded">--.--%</span>
<span id="kospi-change-point" class="text-sm text-white/80">--.--</span>
</div>
</div>
<p id="kospi-last-updated" class="text-xs text-white/70 mt-2">--:--</p>
</div>

<!-- Actions -->
<div class="flex flex-wrap gap-4">
    <button id="how-calculated-button" class="flex-1 flex items-center justify-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
        <span class="material-symbols-outlined text-[18px]">help_outline</span>
        <span data-i18n="how-calculated">How it's calculated</span>
    </button>
    <button id="download-btn" class="flex-1 flex items-center justify-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
        <span class="material-symbols-outlined text-[18px]">download</span>
        <span data-i18n="export-data">Export Data</span>
    </button>
</div>
<button id="send-report-email-btn" class="w-full flex items-center justify-center gap-2 rounded-lg bg-primary/10 px-4 py-2 text-sm font-bold text-primary hover:bg-primary/20">
    <span class="material-symbols-outlined text-[18px]">mail</span>
    <span data-i18n="send-report-email">리포트 이메일로 보내기</span>
</button>
</div>
</div>

<!-- Calculation Logic Section (Hidden by default) -->
<div id="indicator-explanation-section" style="display: none;" class="mt-12">
<h2 class="text-2xl font-bold mb-6 dark:text-white" data-i18n="exp-title-korea">지표별 계산 방식 및 스케일링</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-1-title">1. KOSPI vs 125일 이평선 이격도 (시장 모멘텀)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-1-desc">
            코스피 지수가 125일 이동평균선과 얼마나 떨어져 있는지를 나타내는 지표입니다. 이격도가 크면 과매수(탐욕), 작으면 과매도(공포)로 해석합니다.
        </p>
        <p class="text-sm font-semibold text-primary dark:text-emerald-400" data-i18n="exp-1-scaling">
            <strong>스케일링:</strong> 이격도 0.9 이하 → 0점 (극심한 공포), 이격도 1.1 이상 → 100점 (극심한 탐욕). 0.9 ~ 1.1 범위에서 선형적으로 스케일링됩니다.
        </p>

    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-2-title">2. KOSPI 14일 RSI (주가 강도)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-2-desc">
            KOSPI 지수의 14일 상대강도지수(RSI)를 사용하여 주가의 상승 및 하락 강도를 측정합니다. RSI가 낮으면 과매도(공포), 높으면 과매수(탐욕)로 해석합니다.
        </p>
        <p class="text-sm font-semibold text-primary dark:text-emerald-400" data-i18n="exp-2-scaling">
            <strong>스케일링:</strong> RSI 값 0 ~ 100을 그대로 0점 ~ 100점으로 스케일링합니다. 0점은 극심한 공포, 100점은 극심한 탐욕을 나타냅니다.
        </p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-3-title">3. ADR (상승/하락 비율) (시장 폭)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-3-desc">
            일정 기간 동안 상승한 종목 수와 하락한 종목 수의 비율을 나타내는 지표입니다. ADR이 낮으면 시장 전반의 하락세(공포), 높으면 상승세(탐욕)를 의미합니다.
        </p>
        <p class="text-sm font-semibold text-primary dark:text-emerald-400" data-i18n="exp-3-scaling">
            <strong>스케일링:</strong> ADR 70 이하 → 0점 (극심한 공포), ADR 120 이상 → 100점 (극심한 탐욕). 70 ~ 120 범위에서 선형적으로 스케일링됩니다.
        </p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-4-title">4. VKOSPI (변동성) (시장 변동성)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-4-desc">
            코스피200 변동성 지수(VKOSPI)는 시장의 예상 변동성을 나타내며, 투자자들의 공포 심리를 반영합니다. VKOSPI 값이 높으면 시장의 불확실성 증가(공포), 낮으면 안정(탐욕)으로 해석합니다.
        </p>
        <p class="text-sm font-semibold text-primary dark:text-emerald-400" data-i18n="exp-4-scaling">
            <strong>스케일링:</strong> VKOSPI 40 이상 → 0점 (극심한 공포), VKOSPI 10 이하 → 100점 (극심한 탐욕). 10 ~ 40 범위에서 역비례하여 선형적으로 스케일링됩니다.
        </p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-5-title">5. 코스피200 옵션 풋콜 비율 (옵션 풋콜 비율)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-5-desc">
            코스피200 옵션 시장에서 풋옵션 거래량과 콜옵션 거래량의 비율을 나타내는 지표입니다. 풋옵션 거래량(하락에 베팅)이 많으면 공포, 콜옵션 거래량(상승에 베팅)이 많으면 탐욕으로 해석합니다.
        </p>
        <p class="text-sm font-semibold text-primary dark:text-emerald-400" data-i18n="exp-5-scaling">
            <strong>스케일링:</strong> PCR 1.8 이상 → 0점 (극심한 공포), PCR 0.6 이하 → 100점 (극심한 탐욕). 0.6 ~ 1.8 범위에서 역비례하여 선형적으로 스케일링됩니다.
        </p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="exp-6-title">6. 최종 공포 탐욕 지수 계산</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mb-2" data-i18n="exp-6-desc">
            최종 공포 탐욕 지수는 위 5가지 지표들의 가중 평균을 통해 산출됩니다. 각 지표는 시장 심리 분석에 있어 서로 다른 중요도를 가지므로, 다음과 같은 가중치를 적용합니다.
        </p>
        <ul class="text-sm font-semibold list-disc pl-5">
            <li class="text-primary dark:text-emerald-400" data-i18n="exp-6-list-1"><strong>지표 1 (KOSPI vs 125일 이평선 이격도):</strong> 25%</li>
            <li class="text-primary dark:text-emerald-400" data-i18n="exp-6-list-2"><strong>지표 2 (KOSPI 14일 RSI):</strong> 20%</li>
            <li class="text-primary dark:text-emerald-400" data-i18n="exp-6-list-3"><strong>지표 3 (ADR):</strong> 20%</li>
            <li class="text-primary dark:text-emerald-400" data-i18n="exp-6-list-4"><strong>지표 4 (VKOSPI):</strong> 20%</li>
            <li class="text-primary dark:text-emerald-400" data-i18n="exp-6-list-5"><strong>지표 5 (코스피200 옵션 풋콜 비율):</strong> 15%</li>
        </ul>
        <p class="text-sm text-[#49699c] dark:text-slate-400 mt-2" data-i18n="exp-6-footer">
            이러한 가중치를 통해 시장의 다양한 측면을 종합적으로 반영한 공포 탐욕 지수를 제공합니다.
        </p>
    </div>
</div>
</div>

<footer class="mt-16 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-8 pb-12">
<p class="text-[11px] leading-relaxed text-[#49699c] dark:text-slate-500 mb-6 max-w-4xl" data-i18n="disclaimer-desc">본 정보는 참고용이며 투자 권유를 목적으로 하지 않습니다. AI 분석의 특성상 실시간 데이터 반영이 지연되거나 기술적 오류가 발생할 수 있으므로, 제공되는 수치의 정확성을 보장하지 않습니다. 실제 시장 지표와 다를 수 있으니 유의하시기 바랍니다.</p>
<div class="flex flex-wrap items-center justify-between gap-6 text-[#49699c] dark:text-slate-500">
<p class="text-sm font-medium dark:text-white" data-i18n="footer-desc-korea">Data provided by KRX and KOFIA.</p>
<div class="flex flex-wrap gap-4">
    <a href="/about.html" class="text-xs font-bold hover:text-primary transition-colors" data-i18n="about-us">서비스 소개</a>
    <a href="/terms.html" class="text-xs font-bold hover:text-primary transition-colors" data-i18n="terms-of-service">이용약관</a>
    <a href="/privacy.html" class="text-xs font-bold hover:text-primary transition-colors" data-i18n="privacy-policy">개인정보처리방침</a>
</div>
</div>
</footer>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBumYJj1X1KrjwjWTZhGuO0B-xZJj1fLsE",
        authDomain: "anse-sample1-46739525-2d1c0.firebaseapp.com",
        projectId: "anse-sample1-46739525-2d1c0",
        storageBucket: "anse-sample1-46739525-2d1c0.firebasestorage.app",
        messagingSenderId: "164266713411",
        appId: "1:164266713411:web:31e470b1a7320aa6028ff6"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function updateGauge(score) {
        const needle = document.getElementById('gauge-needle');
        const scoreDisplay = document.getElementById('score');
        const sentimentText = document.getElementById('status');
        const rotation = (score / 100) * 180 - 90;
        if(needle) needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
        if(scoreDisplay) scoreDisplay.textContent = score;

        let color = "text-yellow-400";
        let statusKey = "neutral";
        if (score < 20) { color = "text-red-500"; statusKey = "extreme-fear"; }
        else if (score < 40) { color = "text-orange-500"; statusKey = "fear"; }
        else if (score >= 80) { color = "text-blue-500"; statusKey = "extreme-greed"; }
        else if (score >= 60) { color = "text-emerald-500"; statusKey = "greed"; }

        [scoreDisplay, sentimentText].forEach(el => {
            if(el) {
                el.classList.remove("text-red-500", "text-orange-500", "text-yellow-500", "text-emerald-500", "text-blue-500", "text-primary");
                el.classList.add(color);
                if(el === sentimentText) el.textContent = i18n.translate(statusKey).toUpperCase();
            }
        });
    }

    function updateKOSPIStatus() {
        const now = new Date();
        const hour = now.getUTCHours() + 9; // KST
        const min = now.getUTCMinutes();
        const isWeekday = now.getUTCDay() >= 1 && now.getUTCDay() <= 5;
        const isMarketOpen = isWeekday && (hour > 9 || (hour === 9 && min >= 0)) && (hour < 15 || (hour === 15 && min <= 30));

        const txt = document.getElementById('market-status-text');
        const dot = document.getElementById('market-status-dot');
        const ind = document.getElementById('market-status-indicator');

        if (!txt || !dot || !ind) return;

        if (isMarketOpen) {
            txt.textContent = i18n.translate("market-open");
            txt.setAttribute('data-i18n', 'market-open');
            dot.className = "h-2 w-2 rounded-full bg-emerald-500 animate-pulse";
            ind.className = "flex items-center gap-2 rounded-full px-6 py-2 text-xs font-bold bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400";
        } else {
            txt.textContent = i18n.translate("market-closed");
            txt.setAttribute('data-i18n', 'market-closed');
            dot.className = "h-2 w-2 rounded-full bg-red-500";
            ind.className = "flex items-center gap-2 rounded-full px-6 py-2 text-xs font-bold bg-slate-200/60 dark:bg-slate-800/90 text-slate-400 dark:text-slate-400";
        }
    }

    async function fetchLatestIndex() {
        try {
            const querySnapshot = await db.collection("korea_index").orderBy("timestamp", "desc").limit(1).get();
            if (querySnapshot.empty) return;
            const doc = querySnapshot.docs[0].data();
            
            updateGauge(doc.score);
            
            // KOSPI Value
            document.getElementById('kospi-value').textContent = doc.kospi_value.toFixed(2);
            document.getElementById('kospi-change-rate').textContent = `${doc.kospi_change_rate > 0 ? '+' : ''}${doc.kospi_change_rate.toFixed(2)}%`;
            document.getElementById('kospi-change-point').textContent = `${doc.kospi_change_point > 0 ? '▲' : '▼'} ${Math.abs(doc.kospi_change_point).toFixed(2)}`;
            
            const dateObj = doc.timestamp.toDate();
            const currentLang = i18n.getLanguage();
            const locale = currentLang === 'ko' ? 'ko-KR' : 'en-US';
            const time = dateObj.toLocaleString(locale, { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: true 
            }) + ' ' + i18n.translate("time-suffix");
            document.getElementById('last-updated-time').innerHTML = `<span data-i18n="last-updated">${i18n.translate("last-updated")}</span>: ${time}`;
            document.getElementById('kospi-last-updated').textContent = time;

            // Dynamic Indicators
            const container = document.getElementById('dynamic-indicators-container');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const val = doc[`indicator${i}`];
                if(val === undefined) continue;
                
                let color = "bg-primary"; // Extreme Greed
                if(val < 20) color = "bg-red-400"; // Extreme Fear
                else if(val < 40) color = "bg-orange-400"; // Fear
                else if(val < 60) color = "bg-yellow-400"; // Neutral
                else if(val < 80) color = "bg-emerald-500"; // Greed
                
                container.innerHTML += `
                    <div class="flex flex-col gap-1">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="dark:text-white">${i18n.translate(`indicator${i}`)}</span>
                            <span class="${color.replace('bg-', 'text-')}">${val.toFixed(2)}</span>
                        </div>
                        <div class="h-1.5 w-full rounded-full bg-slate-100 dark:bg-slate-800">
                            <div class="h-full rounded-full ${color}" style="width: ${val}%;"></div>
                        </div>
                    </div>`;
            }
        } catch (e) { console.error(e); }
    }

    function displayRandomProverb() {
        const list = proverbs[i18n.getLanguage()] || proverbs.en;
        const text = list[Math.floor(Math.random() * list.length)];
        document.getElementById('proverb-text').textContent = text;
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchLatestIndex();
        displayRandomProverb();
        updateKOSPIStatus();
        
        document.getElementById('generate-proverb')?.addEventListener('click', displayRandomProverb);
        document.getElementById('how-calculated-button')?.addEventListener('click', () => {
            const sec = document.getElementById('indicator-explanation-section');
            sec.style.display = sec.style.display === 'none' ? 'block' : 'none';
            if(sec.style.display === 'block') sec.scrollIntoView({ behavior: 'smooth' });
        });

        // Advisors
        const updateAdvisor = (id) => {
            fetch(`${id}_adv_ko_en.html`).then(r => r.text()).then(html => {
                document.getElementById('advisor-advice-display').innerHTML = html;
                ['gemini', 'gpt', 'grok'].forEach(a => {
                    const btn = document.getElementById(`advisor-${a}`);
                    if (btn) {
                        btn.className = (a === id) ? "rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary" : "rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800";
                    }
                });
            });
        };
        // Gemini 버튼만 활성화
        document.getElementById('advisor-gemini')?.addEventListener('click', () => updateAdvisor('gemini'));
        updateAdvisor('gemini');

        window.addEventListener('languageChanged', () => {
            fetchLatestIndex();
            displayRandomProverb();
            updateKOSPIStatus();
        });
    });
</script>

<script>
    document.getElementById('download-btn')?.addEventListener('click', async () => {
        if (typeof html2canvas === 'undefined') return;
        const btn = document.getElementById('download-btn');
        const original = btn.innerHTML;
        btn.disabled = true; btn.textContent = "...";
        try {
            const canvas = await html2canvas(document.querySelector('main'), { scale: 2, useCORS: true });
            const link = document.createElement('a');
            link.download = `anse-report-${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        } finally { btn.disabled = false; btn.innerHTML = original; }
    });

    document.getElementById('send-report-email-btn')?.addEventListener('click', async () => {
        if (!window.supabaseClient) return;
        const { data: { user } } = await window.supabaseClient.auth.getUser();
        if (!user) return alert(i18n.translate("login-required"));
        
        const btn = document.getElementById('send-report-email-btn');
        btn.disabled = true;
        try {
            const res = await fetch('/api/send-report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_email: user.email, market: 'korea' })
            });
            if((await res.json()).success) alert("Sent!");
        } finally { btn.disabled = false; }
    });
</script>
<script src="header.js"></script>
</body>
</html>