<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-i18n="title-us">미국 주식 공포 탐욕 지수 - CNN Fear & Greed Index 분석 | anse.ai</title>
<meta name="description" content="미국 주식 시장의 실시간 공포 탐욕 지수(CNN Fear & Greed Index)를 확인하세요. S&P 500 모멘텀, 변동성, 옵션 데이터를 바탕으로 전문적인 시장 심리 분석을 제공합니다." data-i18n="desc-us"/>
<link rel="canonical" href="https://anse.ai.kr/sentiment.html"/>

<!-- Open Graph / Facebook -->
<meta property="og:site_name" content="anse.ai - 주식 시장 심리 분석"/>
<meta property="og:title" content="미국 주식 공포 탐욕 지수 - CNN Fear & Greed Index 분석" data-i18n="title-us"/>
<meta property="og:description" content="미국 주식 시장의 투자 심리를 한눈에 파악하세요." data-i18n="desc-us"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://anse.ai.kr/sentiment.html"/>
<meta property="og:image" content="https://anse.ai.kr/images/neutral.png"/>
<meta name="author" content="anse.ai"/>

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="미국 주식 공포 탐욕 지수 - CNN Fear & Greed Index 분석" data-i18n="title-us"/>
<meta name="twitter:description" content="미국 주식 시장의 투자 심리를 한눈에 파악하세요." data-i18n="desc-us"/>
<meta name="twitter:image" content="https://anse.ai.kr/images/neutral.png"/>

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "anse.ai US Fear & Greed Index Analysis",
  "url": "https://anse.ai.kr/sentiment.html",
  "description": "Analysis of US stock market sentiment using CNN Business Fear & Greed Index components.",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "미국 공포 탐욕 지수란 무엇인가요?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "미국 주식 시장의 투자 심리를 측정하기 위해 CNN Business에서 개발한 지수입니다. 시장의 모멘텀, 주가 강도, 옵션 거래량 등 7가지 요소를 종합하여 산출합니다."
      }
    }
  ]
}
</script>

<!-- Existing styles and icons -->
<link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

<!-- Tailwind CSS and Fonts -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="translations.js"></script>
<script src="proverbs.js"></script>
<script src="i18n.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3d84f5",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101722",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'OPSZ' 24; }
        .gauge-gradient {
            background: conic-gradient(from 180deg at 50% 100%, #f87171 0deg, #fbbf24 90deg, #3d84f5 180deg);
        }
        /* Language-specific display rules */
        html[lang="ko"] .lang-en { display: none !important; }
        html[lang="en"] .lang-ko { display: none !important; }
    </style>

<!-- Google Analytics and Clarity -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C8QR98TVTB');
    </script>

<script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v2qmp0i82b");
    </script>

<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "미국 금융시장 심리",
      "url": "https://anse.ai.kr/sentiment.html",
      "description": "미국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요.",
      "datePublished": "2026-01-17",
      "author": {
        "@type": "Person",
        "name": "anse"
      }
    }
    </script>

</head>
<body class="min-h-screen bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-200">
<!-- Top Navigation Bar -->
<header class="sticky top-0 z-50 w-full border-b border-solid border-[#e7ecf4] dark:border-[#1e293b] bg-white/80 dark:bg-background-dark/80 backdrop-blur-md">
<div class="mx-auto flex max-w-[1200px] items-center justify-between px-3 py-3 md:px-6">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3">
<div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary shrink-0">
<span class="material-symbols-outlined text-[20px] text-white">leaderboard</span>
</div>
<h2 class="text-lg font-bold tracking-tight dark:text-white">US Fear &amp; Greed</h2>
</div>
<div class="hidden md:flex items-center gap-6"> <!-- Desktop Nav -->
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html" data-i18n="nav-korea">한국 금융시장 심리</a>
<a class="text-sm font-semibold text-primary" href="/sentiment.html" data-i18n="nav-us">미국 금융시장 심리</a>
</div>
</div>
<div class="flex flex-wrap items-center justify-end gap-2 md:gap-4">
<button id="menu-button" class="flex md:hidden h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined dark:text-white">menu</span>
</button>

<button id="theme-switcher" class="flex h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined dark:text-white">light_mode</span>
</button>
<div id="auth-container" class="flex items-center gap-2">
    <button id="login-button" class="hidden flex h-10 px-4 items-center justify-center rounded-lg bg-primary text-white font-bold hover:opacity-90 transition-opacity" data-i18n="login">Login</button>
    <div id="user-profile" class="hidden relative flex items-center gap-3">
        <div id="user-avatar" class="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/20 cursor-pointer" data-alt="User profile avatar"></div>
        <!-- Profile Dropdown -->
        <div id="profile-dropdown" class="hidden absolute right-0 top-12 w-48 rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] shadow-lg z-[60] overflow-hidden">
            <div class="px-4 py-3 border-b border-[#e7ecf4] dark:border-[#1e293b]">
                <p id="dropdown-user-name" class="text-sm font-bold truncate dark:text-white"></p>
                <p id="dropdown-user-email" class="text-xs text-[#49699c] dark:text-slate-400 truncate"></p>
            </div>
            <button id="my-account-btn" class="w-full text-left px-4 py-2 text-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center gap-2 dark:text-slate-200">
                <span class="material-symbols-outlined text-sm">person</span>
                <span data-i18n="my-account">My Account</span>
            </button>
            <button id="logout-button-dropdown" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">logout</span>
                <span data-i18n="logout">Logout</span>
            </button>
        </div>
    </div>
</div>
</div>
</div>
<div id="mobile-menu" class="md:hidden hidden bg-white/80 dark:bg-background-dark/80 backdrop-blur-md pb-4 border-b border-solid border-[#e7ecf4] dark:border-[#1e293b]">
<nav class="flex flex-col items-center gap-4 py-2">
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html" data-i18n="nav-korea">한국 금융시장 심리</a>
<a class="text-sm font-semibold text-primary" href="/sentiment.html" data-i18n="nav-us">미국 금융 시장 심리</a>
</nav>
</div>
</header>

<!-- My Account Modal -->
<div id="account-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
    <div class="bg-white dark:bg-[#161f2c] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row h-[500px]">
        <!-- Sidebar -->
        <aside class="w-full md:w-48 bg-slate-50 dark:bg-slate-900/50 border-b md:border-b-0 md:border-r border-[#e7ecf4] dark:border-[#1e293b] p-4">
            <h3 class="text-xs font-black text-[#49699c] uppercase tracking-widest mb-4 px-2" data-i18n="my-account">My Account</h3>
            <nav class="space-y-1">
                <button id="nav-overview" class="w-full text-left px-3 py-2 rounded-lg bg-primary text-white text-sm font-bold flex items-center gap-2 transition-colors">
                    <span class="material-symbols-outlined text-sm">grid_view</span>
                    <span data-i18n="overview">Overview</span>
                </button>
                <button id="nav-settings" class="w-full text-left px-3 py-2 rounded-lg text-[#49699c] dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-bold flex items-center gap-2 transition-colors">
                    <span class="material-symbols-outlined text-sm">settings</span>
                    <span data-i18n="settings">Settings</span>
                </button>
            </nav>
        </aside>
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="p-6 flex items-center justify-between border-b border-[#e7ecf4] dark:border-[#1e293b]">
                <h2 id="modal-title" class="text-xl font-bold dark:text-white" data-i18n="overview">Overview</h2>
                <button id="close-modal" class="h-8 w-8 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined dark:text-white">close</span>
                </button>
            </header>
            <main class="flex-1 p-8 overflow-y-auto">
                <!-- Overview Section -->
                <div id="section-overview" class="flex flex-col gap-8">
                    <!-- User Profile Info -->
                    <section class="flex items-center gap-4">
                        <div id="modal-user-avatar" class="h-16 w-16 rounded-full bg-cover bg-center ring-4 ring-primary/10"></div>
                        <div class="flex flex-col">
                            <h4 id="modal-user-name" class="text-lg font-black dark:text-white"></h4>
                            <p id="modal-user-email" class="text-sm text-[#49699c] dark:text-slate-400"></p>
                        </div>
                    </section>
                    <!-- Subscription Status -->
                    <section id="subscription-section" class="rounded-xl border border-primary/20 bg-primary/5 p-6 border-dashed">
                        <div class="flex flex-col gap-4">
                            <div class="flex flex-col gap-1">
                                <h5 class="font-bold dark:text-white" data-i18n="subscribe">구독하기</h5>
                                <p id="subscription-status-text" class="text-xs text-[#49699c] dark:text-slate-400" data-i18n="subscription-benefit">구독 시 일 1~2회 시장 지표 및 인공지능 분석 리포트를 이메일로 보내드립니다.</p>
                            </div>
                            <div id="subscription-actions" class="flex gap-2">
                                <button id="subscribe-btn" class="w-fit px-6 py-2.5 bg-primary text-white text-sm font-black rounded-lg hover:opacity-90 transition-opacity flex items-center gap-2">
                                    <span class="material-symbols-outlined text-sm">stars</span>
                                    <span data-i18n="subscribe">구독하기</span>
                                </button>
                                <button id="cancel-subscription-btn" class="hidden w-fit px-6 py-2.5 bg-red-500 text-white text-sm font-black rounded-lg hover:opacity-90 transition-opacity flex items-center gap-2">
                                    <span class="material-symbols-outlined text-sm">cancel</span>
                                    <span>구독 취소</span>
                                </button>
                            </div>
                        </div>
                    </section>
                </div>

                        <div id="section-settings" class="hidden flex flex-col gap-8">
                    <section class="flex flex-col gap-6">
                        <div class="flex flex-col gap-2">
                            <h5 class="font-bold dark:text-white" data-i18n="report-language">리포트 언어 설정</h5>
                            <p class="text-xs text-[#49699c] dark:text-slate-400" data-i18n="report-lang-desc">이메일 리포트를 수신할 언어를 선택해주세요.</p>
                            <div class="flex gap-3 mt-2">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="report-lang" value="ko" checked class="w-4 h-4 text-primary border-slate-300 focus:ring-primary">
                                    <span class="text-sm font-medium dark:text-slate-300 group-hover:text-primary transition-colors">한국어 (Korean)</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="report-lang" value="en" class="w-4 h-4 text-primary border-slate-300 focus:ring-primary">
                                    <span class="text-sm font-medium dark:text-slate-300 group-hover:text-primary transition-colors">영어 (English)</span>
                                </label>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>
</div>
<main class="mx-auto max-w-[1200px] px-6 py-8">
<!-- Page Heading -->
<div class="mb-8 flex flex-wrap items-end justify-between gap-8">
<div class="flex flex-col gap-1">
<h1 class="text-3xl font-black tracking-tight dark:text-white" data-i18n="title-us">US Market Sentiment</h1>
<p class="text-base text-[#49699c] dark:text-slate-400" data-i18n="us-sentiment-analysis-desc">CNN Business Fear &amp; Greed Index analysis.</p>
</div>
<div id="market-status-indicator" class="flex items-center gap-2 rounded-full bg-slate-100 dark:bg-slate-800 px-6 py-2 text-xs font-bold text-slate-600 dark:text-slate-400">
    <span id="market-status-dot" class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
    <span id="market-status-text" data-i18n="updating">Updating...</span>
</div>
<div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
<!-- Main Gauge Section -->
<div class="lg:col-span-8">
<div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
<div class="mb-4 flex flex-wrap items-center justify-between gap-3">
<h3 class="text-lg font-bold" data-i18n="current-sentiment">Current Sentiment</h3>
<span id="last-updated-time" class="text-sm font-medium text-[#49699c]"><span data-i18n="last-updated">Last updated</span>: -</span>
</div>
<div class="relative flex flex-col items-center py-10">
<!-- Gauge visualization -->
<div class="relative h-48 w-80 overflow-hidden rounded-t-full bg-slate-100 dark:bg-slate-800">
<!-- Gauge segments colored with conic gradient -->
<div class="absolute inset-0 gauge-gradient opacity-80" style="clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);"></div>
<div class="absolute bottom-0 left-1/2 h-32 w-64 -translate-x-1/2 rounded-t-full bg-white dark:bg-[#161f2c]"></div>
<!-- Needle -->
<div class="absolute bottom-0 left-1/2 h-40 w-1 -translate-x-1/2 origin-bottom transition-transform duration-1000 ease-out" id="gauge-needle">
<div class="h-full w-full bg-slate-900 dark:bg-white rounded-full"></div>
<div class="absolute -bottom-2 left-1/2 h-4 w-4 -translate-x-1/2 rounded-full bg-slate-900 dark:bg-white"></div>
</div>
</div>
<div class="mt-6 flex flex-col items-center gap-1">
<span id="score" class="text-5xl font-black text-primary"></span>
<span id="status" class="text-2xl font-bold tracking-tight text-primary" data-i18n="loading">LOADING</span>
</div>
<div class="mt-10 flex flex-wrap w-full justify-between px-4 gap-3">
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-red-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-fear">Extreme Fear</span>
</div>
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-yellow-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="neutral">Neutral</span>
</div>
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-primary"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-greed">Extreme Greed</span>
</div>
</div>
</div>
</div>

<!-- Advice/Quote Section (Replaced with Index Advisors) -->
<div class="mt-8 flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
<div class="mb-6 flex items-center justify-between gap-2">
<h3 class="text-lg font-bold" data-i18n="index-advisors">Index Advisors</h3>
<div class="flex flex-wrap gap-2 justify-end">
<button id="advisor-gemini" class="rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary">Gemini</button>
<button id="advisor-gpt" class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">GPT</button>
<button id="advisor-grok" class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Grok</button>
</div>
</div>

<div id="advisor-advice-display" class="mt-0 flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] px-2 py-6 md:px-6 shadow-sm">
    <p class="text-sm dark:text-slate-200" data-i18n="updating">Gemini의 조언 준비중</p>
</div>
</div>
</div>

<!-- Historical Comparisons & Side Metrics -->
<div class="lg:col-span-4 flex flex-col gap-6">
<!-- Proverb Card -->
<div class="flex flex-col gap-4 rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
         <h4 class="text-sm font-bold text-[#49699c] uppercase tracking-wider mb-4" data-i18n="today-proverb">오늘의 주식 시장 격언</h4>
        <p id="proverb-text" class="italic text-base text-gray-800 dark:text-gray-200 min-h-[50px] flex items-center justify-center text-center break-keep" style="white-space: pre-wrap;"></p>
        <button id="generate-proverb" class="mt-4 rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary hover:bg-primary/20 transition-colors" data-i18n="new-proverb">새 격언 확인하기</button>
</div>

<!-- US Market Indices (Static or Placeholder) -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-primary text-white p-6 shadow-sm">
<div class="flex items-center justify-between mb-4">
<h4 class="text-sm font-bold uppercase tracking-wider">S&amp;P 500</h4>
<a href="https://www.google.com/finance/quote/.INX:INDEXSP" target="_blank"><span class="material-symbols-outlined">insights</span></a>
</div>
<div class="flex flex-col gap-1">
<p id="market-index-value" class="text-3xl font-black" data-i18n="view-online">View Online</p>
<p class="text-xs text-white/70 mt-2" data-i18n="click-to-chart">Click icon to see real-time chart</p>
</div>
</div>

<div class="flex flex-wrap gap-4">
    <button id="how-calculated-button" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
    <span class="material-symbols-outlined text-[18px] dark:text-white">help_outline</span>
                            <span data-i18n="how-calculated">How it's calculated</span>
                        </button>
    <button id="download-btn" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
    <span class="material-symbols-outlined text-[18px] dark:text-white">download</span>
                            <span data-i18n="export-data">Export Data</span>
                        </button>
    <button id="send-report-email-btn" class="flex items-center gap-2 rounded-lg bg-primary/10 px-4 py-2 text-sm font-bold text-primary hover:bg-primary/20">
    <span class="material-symbols-outlined text-[18px]">mail</span>
                            <span data-i18n="send-report-email">리포트 이메일로 보내기</span>
                        </button>
    </div>
</div>
</div>
</div>

<div id="indicator-explanation-section" style="display: none;" class="mt-8">
<h2 class="text-2xl font-bold mb-4 dark:text-white" data-i18n="how-calculated">지표별 계산 방식 (CNN Fear &amp; Greed)</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-1-title">1. 주가 모멘텀 (Stock Price Momentum)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-1-desc">S&amp;P 500 지수와 125일 이동평균선을 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-2-title">2. 주가 강도 (Stock Price Strength)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-2-desc">52주 신고가와 신저가 종목 수를 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-3-title">3. 주가 폭 (Stock Price Breadth)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-3-desc">상승 종목과 하락 종목의 거래량을 분석합니다. (McClellan Summation Index)</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-4-title">4. 풋/콜 옵션 (Put and Call Options)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-4-desc">풋 옵션과 콜 옵션의 거래량 비율을 측정합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-5-title">5. 시장 변동성 (Market Volatility)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-5-desc">VIX 지수와 50일 이동평균선을 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-6-title">6. 안전 자산 수요 (Safe Haven Demand)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-6-desc">주식 수익률과 국채 수익률의 차이를 분석합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-7-title">7. 정크 본드 수요 (Junk Bond Demand)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-7-desc">투자 등급 채권과 투기 등급 채권의 수익률 스프레드를 분석합니다.</p>
    </div>
</div>
</div>


<!-- Educational Content Section -->
<article class="mt-16 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-12">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        <section class="flex flex-col gap-4">
            <h2 class="text-2xl font-black dark:text-white" data-i18n="understanding-us-fng-title">미국 시장 심리 이해하기</h2>
            <p class="text-base leading-relaxed text-[#49699c] dark:text-slate-400 break-keep" data-i18n="understanding-us-fng-desc">
                미국 주식 시장은 전 세계 금융의 중심이며, 투자 심리의 변화에 매우 민감하게 반응합니다. CNN Business의 공포와 탐욕 지수는 시장의 7가지 주요 지표를 종합하여 현재의 심리 상태를 나타냅니다. 이 지수가 극단적인 공포에 도달했을 때는 시장의 반등 기회를, 극단적인 탐욕에 도달했을 때는 조정의 위험을 경고하는 신호로 활용될 수 있습니다.
            </p>
        </section>
        <section class="flex flex-col gap-4">
            <h2 class="text-2xl font-black dark:text-white" data-i18n="how-to-us-title">미국 시장 심리 활용 가이드</h2>
            <div class="space-y-4">
                <div class="p-4 rounded-lg bg-slate-50 dark:bg-slate-900/50">
                    <strong class="text-primary block mb-1" data-i18n="how-to-us-step-1-t">1단계: S&P 500 모멘텀 체크</strong>
                    <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="how-to-us-step-1-d">CNN 지수가 지시하는 심리가 실제 S&P 500 지수의 추세와 일치하는지 확인합니다.</p>
                </div>
                <div class="p-4 rounded-lg bg-slate-50 dark:bg-slate-900/50">
                    <strong class="text-primary block mb-1" data-i18n="how-to-us-step-2-t">2단계: VIX 변동성 대조</strong>
                    <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="how-to-us-step-2-d">공포 지수인 VIX가 급등할 때 나타나는 지수의 변화를 통해 시장의 바닥을 탐색합니다.</p>
                </div>
                <div class="p-4 rounded-lg bg-slate-50 dark:bg-slate-900/50">
                    <strong class="text-primary block mb-1" data-i18n="how-to-us-step-3-t">3단계: 글로벌 자금 흐름 관찰</strong>
                    <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="how-to-us-step-3-d">극심한 탐욕 구간에서는 글로벌 자산 배분 전략을 통해 리스크를 분산합니다.</p>
                </div>
            </div>
        </section>
    </div>
</article>

<!-- Footer -->
<footer class="mt-12 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-8 pb-12">
<div class="flex flex-wrap items-center justify-between gap-6 text-[#49699c] dark:text-slate-500">
<div class="flex flex-col gap-2">
<p class="text-sm font-medium dark:text-white" data-i18n="footer-desc-us">Data provided by CNN Business.</p>
<p class="max-w-md text-xs leading-relaxed dark:text-white" data-i18n="fng-theory">The Fear &amp; Greed Index is a way to gauge stock market movements and whether stocks are fairly priced. CNN examines seven different factors to establish how much fear and greed there is in the market.</p>
</div>
<div class="flex flex-wrap gap-4">
    <span class="text-xs font-bold text-[#49699c] dark:text-slate-400" data-i18n="contact-us">Contact: info@anse.ai.kr</span>
    <a href="/about.html" class="text-xs font-bold text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" data-i18n="about-us">서비스 소개</a>
    <a href="/terms.html" class="text-xs font-bold text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" data-i18n="terms-of-service">이용약관</a>
    <a href="/privacy.html" class="text-xs font-bold text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" data-i18n="privacy-policy">개인정보처리방침</a>
    <a href="/refund.html" class="text-xs font-bold text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" data-i18n="refund-policy">환불정책</a>
</div>
</div>
</footer>
</main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      // Firebase initialization
      const firebaseConfig = {
        apiKey: "AIzaSyBumYJj1X1KrjwjWTZhGuO0B-xZJj1fLsE",
        authDomain: "anse-sample1-46739525-2d1c0.firebaseapp.com",
        projectId: "anse-sample1-46739525-2d1c0",
        storageBucket: "anse-sample1-46739525-2d1c0.firebasestorage.app",
        messagingSenderId: "164266713411",
        appId: "1:164266713411:web:31e470b1a7320aa6028ff6"
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.firestore();

        // Update gauge
        function updateGauge(score) {
            const needle = document.getElementById('gauge-needle');
            const scoreDisplay = document.getElementById('score');
            const statusEl = document.getElementById('status');

            const rotationDegree = (score / 100) * 180 - 90;
            needle.style.transform = `translateX(-50%) rotate(${rotationDegree}deg)`;
            scoreDisplay.textContent = Math.round(score);

            let textColorClass = "";
            let statusKey = "";
            if (score <= 25) { textColorClass = "text-red-500"; statusKey = "extreme-fear"; } 
            else if (score <= 44) { textColorClass = "text-orange-500"; statusKey = "fear"; }
            else if (score <= 55) { textColorClass = "text-yellow-500"; statusKey = "neutral"; }
            else if (score <= 75) { textColorClass = "text-emerald-500"; statusKey = "greed"; }
            else { textColorClass = "text-blue-500"; statusKey = "extreme-greed"; }

            scoreDisplay.classList.remove("text-red-500", "text-orange-500", "text-yellow-500", "text-emerald-500", "text-blue-500", "text-primary");
            scoreDisplay.classList.add(textColorClass);
            statusEl.textContent = i18n.translate(statusKey).toUpperCase();
            statusEl.classList.remove("text-red-500", "text-orange-500", "text-yellow-500", "text-emerald-500", "text-blue-500", "text-primary");
            statusEl.classList.add(textColorClass);
            statusEl.removeAttribute('data-i18n'); // Prevent reset on lang change
        }

        // US Market Status (NYSE/NASDAQ)
        function updateUSMarketStatus() {
            const marketStatusText = document.getElementById('market-status-text');
            const marketStatusDot = document.getElementById('market-status-dot');
            const marketStatusIndicator = document.getElementById('market-status-indicator');

            // US Market Hours: 9:30 AM - 4:00 PM ET
            // We'll use a simple approach based on UTC
            const now = new Date();
            const utcHour = now.getUTCHours();
            const utcMinute = now.getUTCMinutes();
            const day = now.getUTCDay(); // 0: Sun, 1: Mon, ..., 6: Sat

            // Standard Time (EST): UTC-5 -> 14:30 - 21:00 UTC
            // Daylight Saving (EDT): UTC-4 -> 13:30 - 20:00 UTC
            // For simplicity, let's assume EDT (usually Mar-Nov) or just check a range
            // More robust: use Intl.DateTimeFormat
            const nyTime = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                hour: 'numeric',
                minute: 'numeric',
                hour12: false,
                weekday: 'short'
            }).formatToParts(now);

            const hourPart = nyTime.find(p => p.type === 'hour').value;
            const minutePart = nyTime.find(p => p.type === 'minute').value;
            const weekdayPart = nyTime.find(p => p.type === 'weekday').value;

            const hour = parseInt(hourPart);
            const minute = parseInt(minutePart);
            const isWeekend = weekdayPart === 'Sat' || weekdayPart === 'Sun';

            let isOpen = false;
            if (!isWeekend) {
                const totalMinutes = hour * 60 + minute;
                if (totalMinutes >= (9 * 60 + 30) && totalMinutes < (16 * 60)) {
                    isOpen = true;
                }
            }

            if (isOpen) {
                marketStatusText.textContent = i18n.translate("market-open");
                marketStatusText.removeAttribute('data-i18n'); // Prevent reset on lang change
                marketStatusDot.classList.add('bg-emerald-500', 'animate-pulse');
                marketStatusIndicator.classList.add('bg-emerald-100', 'text-emerald-600');
            } else {
                marketStatusText.textContent = i18n.translate("market-closed");
                marketStatusText.removeAttribute('data-i18n'); // Prevent reset on lang change
                marketStatusDot.classList.add('bg-red-500');
                marketStatusIndicator.classList.add('bg-slate-200/60', 'text-slate-600');
            }
        }

        async function fetchUSSentiment() {
            const quoteEl = document.getElementById('sentiment-quote');
            const lastUpdatedEl = document.getElementById('last-updated-time');

            try {
                const doc = await db.collection('market_sentiment').doc('cnn_fng').get();
                if (doc.exists) {
                    const data = doc.data();
                    const value = data.value;
                    updateGauge(value);

                    let quoteText = "";
                    if (value >= 0 && value <= 24) { quoteText = i18n.translate("quote-extreme-fear"); }
                    else if (value >= 25 && value <= 44) { quoteText = i18n.translate("quote-fear"); }
                    else if (value >= 45 && value <= 55) { quoteText = i18n.translate("quote-neutral"); }
                    else if (value >= 56 && value <= 75) { quoteText = i18n.translate("quote-greed"); }
                    else if (value >= 76 && value <= 100) { quoteText = i18n.translate("quote-extreme-greed"); }
                    else { quoteText = i18n.translate("quote-unknown"); }

                    if (quoteEl) quoteEl.textContent = quoteText;
                    
                    if (data.last_update) {
                        const timeSuffix = i18n.translate("time-suffix");
                        const lastUpdatedLabel = i18n.translate("last-updated");
                        lastUpdatedEl.innerHTML = `<span data-i18n="last-updated">${lastUpdatedLabel}</span>: ${data.last_update} ${timeSuffix}`;
                    }
                } else {
                    if (quoteEl) quoteEl.textContent = i18n.translate("preparing-advice");
                }
            } catch (error) {
                console.error("Error fetching US sentiment:", error);
                quoteEl.textContent = i18n.translate("failed-to-load-advice");
            }
        }

        function displayRandomProverb() {
            const proverbText = document.getElementById('proverb-text');
            if (proverbText) {
                const currentLang = i18n.getLanguage();
                const list = proverbs[currentLang] || proverbs.en;
                const randomIndex = Math.floor(Math.random() * list.length);
                proverbText.textContent = list[randomIndex];
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Theme switcher
            const themeSwitcher = document.getElementById('theme-switcher');
            themeSwitcher.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                const icon = themeSwitcher.querySelector('.material-symbols-outlined');
                icon.textContent = isDarkMode ? 'dark_mode' : 'light_mode';
            });
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                themeSwitcher.querySelector('.material-symbols-outlined').textContent = 'dark_mode';
            }

            // Mobile menu
            document.getElementById('menu-button').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            fetchUSSentiment();
            updateUSMarketStatus();
            displayRandomProverb();
            document.getElementById('generate-proverb').addEventListener('click', displayRandomProverb);

            document.getElementById('how-calculated-button').addEventListener('click', () => {
                const section = document.getElementById('indicator-explanation-section');
                const isOpening = section.style.display === 'none';
                if (isOpening) {
                    section.style.display = 'block';
                    // Small timeout to ensure DOM has rendered the block before scrolling
                    setTimeout(() => {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 10);
                } else {
                    section.style.display = 'none';
                }
            });

            document.getElementById('download-btn').addEventListener('click', function() {
                html2canvas(document.querySelector('main'), { scale: 2 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'us_sentiment_report.png';
                    link.href = canvas.toDataURL();
                    link.click();
                });
            });

            // Listen for language changes to refresh dynamic content
            window.addEventListener('languageChanged', () => {
                fetchUSSentiment();
                updateUSMarketStatus();
                displayRandomProverb();
            });

            // --- Advisor Display Logic (New) ---
            const advisorFiles = {
                gemini: 'gemini_snp_adv_ko_en.html',
                gpt: 'gpt_snp_adv.html', 
                grok: 'grok_snp_adv.html'
            };

            const advisorGeminiBtn = document.getElementById('advisor-gemini');
            const advisorGptBtn = document.getElementById('advisor-gpt');
            const advisorGrokBtn = document.getElementById('advisor-grok');
            const advisorAdviceDisplay = document.getElementById('advisor-advice-display');
            const advisorButtons = [advisorGeminiBtn, advisorGptBtn, advisorGrokBtn];

            function updateAdvisorDisplay(activeAdvisor) {
                // Reset all buttons
                advisorButtons.forEach(button => {
                    if (!button) return;
                    button.classList.remove('bg-primary/10', 'text-primary');
                    button.classList.add('text-[#49699c]', 'hover:bg-slate-100', 'dark:hover:bg-slate-800');
                });

                // Set active button
                const currentActiveButton = document.getElementById(`advisor-${activeAdvisor}`);
                if (currentActiveButton) {
                    currentActiveButton.classList.remove('text-[#49699c]', 'hover:bg-slate-100', 'dark:hover:bg-slate-800');
                    currentActiveButton.classList.add('bg-primary/10', 'text-primary');
                }

                // Fetch content
                if (advisorAdviceDisplay) {
                    const filePath = advisorFiles[activeAdvisor];
                    fetch(filePath)
                        .then(response => {
                            if (!response.ok) throw new Error('File not found');
                            return response.text();
                        })
                        .then(htmlContent => {
                            advisorAdviceDisplay.innerHTML = htmlContent;
                        })
                        .catch(err => {
                            console.error(`Error loading advisor ${activeAdvisor}:`, err);
                            advisorAdviceDisplay.innerHTML = `<p class="text-sm text-red-500">${i18n.translate("failed-to-load-advice")}</p>`;
                        });
                }
            }

            if (advisorGeminiBtn) advisorGeminiBtn.addEventListener('click', () => updateAdvisorDisplay('gemini'));
            if (advisorGptBtn) advisorGptBtn.addEventListener('click', () => updateAdvisorDisplay('gpt'));
            if (advisorGrokBtn) advisorGrokBtn.addEventListener('click', () => updateAdvisorDisplay('grok'));

            // Initial load
            updateAdvisorDisplay('gemini');
        });
    </script>
    <script>
        // Supabase configuration - Hardcoded for local development
        const SB_URL = 'https://bksuhgixknsqzzxahuni.supabase.co';
        const SB_KEY = 'sb_publishable_K47Ui76Xyb5hqjAOqJsbYg_u0ZFJTdf';
        
        let supabaseClient;
        try {
            console.log("Initializing Supabase (Sentiment Page - Hardcoded)...");
            if (!SB_URL.startsWith('http')) {
                throw new Error("Supabase URL is not provided.");
            }
            const { createClient } = supabase;
            supabaseClient = createClient(SB_URL, SB_KEY);
            console.log("Supabase Client initialized successfully.");
        } catch (e) {
            console.error("Supabase Initialization Error:", e.message);
            const btn = document.getElementById('login-button');
            if (btn) btn.classList.remove('hidden');
        }

        const loginButton = document.getElementById('login-button');
        const userProfile = document.getElementById('user-profile');
        const userAvatar = document.getElementById('user-avatar');
        const profileDropdown = document.getElementById('profile-dropdown');
        const myAccountBtn = document.getElementById('my-account-btn');
        const logoutButtonDropdown = document.getElementById('logout-button-dropdown');
        const accountModal = document.getElementById('account-modal');
        const closeModal = document.getElementById('close-modal');

        // Dropdown toggle
        if (userAvatar) {
            userAvatar.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });
        }

        // Close dropdown when clicking outside
        window.addEventListener('click', () => {
            if (profileDropdown) profileDropdown.classList.add('hidden');
        });

        // Modal toggle
        if (myAccountBtn) {
            myAccountBtn.addEventListener('click', () => {
                if (accountModal) accountModal.classList.remove('hidden');
                if (profileDropdown) profileDropdown.classList.add('hidden');
                switchTab('overview');
            });
        }

        function switchTab(tabId) {
            const overviewBtn = document.getElementById('nav-overview');
            const settingsBtn = document.getElementById('nav-settings');
            const overviewSection = document.getElementById('section-overview');
            const settingsSection = document.getElementById('section-settings');
            const modalTitle = document.getElementById('modal-title');

            if (!overviewBtn || !settingsBtn || !overviewSection || !settingsSection) return;

            const isOverview = tabId === 'overview';
            
            // Toggle Content
            overviewSection.classList.toggle('hidden', !isOverview);
            settingsSection.classList.toggle('hidden', isOverview);
            
            // Toggle Title
            if (modalTitle) {
                modalTitle.setAttribute('data-i18n', isOverview ? 'overview' : 'settings');
                if (window.i18n && typeof i18n.translateElement === 'function') {
                    i18n.translateElement(modalTitle);
                } else if (modalTitle) {
                    modalTitle.textContent = isOverview ? 'Overview' : 'Settings';
                }
            }

            // Toggle Styles (Forcing className)
            const activeStyle = "w-full text-left px-3 py-2 rounded-lg bg-primary text-white text-sm font-bold flex items-center gap-2 transition-colors";
            const inactiveStyle = "w-full text-left px-3 py-2 rounded-lg text-[#49699c] dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-bold flex items-center gap-2 transition-colors";

            if (isOverview) {
                overviewBtn.className = activeStyle;
                settingsBtn.className = inactiveStyle;
            } else {
                settingsBtn.className = activeStyle;
                overviewBtn.className = inactiveStyle;
            }
        }

        // Catch clicks even on child elements (icons/text)
        document.addEventListener('click', function(e) {
            const overviewClick = e.target.closest('#nav-overview');
            const settingsClick = e.target.closest('#nav-settings');
            
            if (overviewClick) { e.preventDefault(); switchTab('overview'); }
            if (settingsClick) { e.preventDefault(); switchTab('settings'); }
        });

        // 'Send Report to Email' Button Click Logic (Dashboard)
        document.getElementById('send-report-email-btn')?.addEventListener('click', async () => {
            const currentLang = document.documentElement.lang || 'ko';
            const btn = document.getElementById('send-report-email-btn');
            const originalContent = btn.innerHTML;

            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) {
                alert(i18n.translate("login-required") || "로그인이 필요합니다.");
                return;
            }

            // Collect Market Data
            const marketData = {
                score: document.getElementById('score')?.textContent,
                status: document.getElementById('status')?.textContent,
                proverb: document.getElementById('proverb-text')?.textContent,
                advice: document.getElementById('advisor-advice-display')?.innerHTML, // Gemini HTML
                kospi: {
                    value: document.getElementById('market-index-value')?.textContent,
                    change_rate: "",
                    change_point: "S&P 500 INDEX",
                    link: "https://www.google.com/finance/quote/.INX:INDEXSP"
                },
                indicators: []
            };

            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined text-sm animate-spin">sync</span><span>Sending...</span>`;

            try {
                const response = await fetch('/api/send-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_email: user.email, 
                        language: currentLang,
                        market_data: marketData,
                        market: 'us',
                        test_mode: false 
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`${currentLang === 'ko' ? '리포트가 이메일로 발송되었습니다!' : 'Report has been sent to your email!'}`);
                } else {
                    throw new Error(result.error);
                }
            } catch (err) {
                alert("Error: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        });

        if (closeModal) {
            closeModal.addEventListener('click', () => {
                accountModal.classList.add('hidden');
            });
        }

        // Close modal when clicking background
        if (accountModal) {
            accountModal.addEventListener('click', (e) => {
                if (e.target === accountModal) accountModal.classList.add('hidden');
            });
        }

        async function updateAuthState() {
            if (!supabaseClient) return;
            
            try {
                const { data: { user }, error } = await supabaseClient.auth.getUser();
                
                if (user) {
                    console.log("User session found:", user.email);
                    loginButton.classList.add('hidden');
                    userProfile.classList.remove('hidden');
                    
                    const avatarUrl = user.user_metadata.avatar_url;
                    const fullName = user.user_metadata.full_name || 'User';
                    const email = user.email;

                    if (avatarUrl) {
                        userAvatar.style.backgroundImage = `url('${avatarUrl}')`;
                        document.getElementById('modal-user-avatar').style.backgroundImage = `url('${avatarUrl}')`;
                    }
                    
                    // Update texts in dropdown and modal
                    document.getElementById('dropdown-user-name').textContent = fullName;
                    document.getElementById('dropdown-user-email').textContent = email;
                    document.getElementById('modal-user-name').textContent = fullName;
                    document.getElementById('modal-user-email').textContent = email;

                    // 구독 상태 체크
                    checkSubscriptionStatus(user.id);

                } else {
                    loginButton.classList.remove('hidden');
                    userProfile.classList.add('hidden');
                }
            } catch (err) {
                loginButton.classList.remove('hidden');
                userProfile.classList.add('hidden');
            }
        }

        async function checkSubscriptionStatus(userId) {
            const statusText = document.getElementById('subscription-status-text');
            const subscribeBtn = document.getElementById('subscribe-btn');
            const cancelBtn = document.getElementById('cancel-subscription-btn');

            if (!statusText || !subscribeBtn || !cancelBtn) return;

            try {
                const { data, error } = await supabaseClient
                    .from('subscriptions')
                    .select('status')
                    .eq('user_id', userId)
                    .maybeSingle();

                if (data && data.status === 'active') {
                    statusText.innerHTML = '<span class="text-emerald-500 font-black">구독 중</span> (매일 리포트가 발송됩니다)';
                    subscribeBtn.classList.add('hidden');
                    cancelBtn.classList.remove('hidden');
                } else {
                    statusText.textContent = i18n.translate("subscription-benefit");
                    subscribeBtn.classList.remove('hidden');
                    cancelBtn.classList.add('hidden');
                }
            } catch (err) {
                console.error("Subscription check error:", err);
            }
        }

        // 구독 버튼 이벤트
        document.getElementById('subscribe-btn')?.addEventListener('click', async () => {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) return alert("로그인이 필요합니다.");

            const btn = document.getElementById('subscribe-btn');
            btn.disabled = true;
            const originalText = btn.innerHTML;
            btn.textContent = "연결 중...";

            try {
                const response = await fetch('/api/create-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: user.id, user_email: user.email })
                });
                const result = await response.json();
                if (result.url) {
                    window.location.href = result.url;
                } else {
                    alert("결제 페이지를 불러오지 못했습니다: " + (result.error || "Unknown error"));
                }
            } catch (err) {
                alert("오류가 발생했습니다: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });

        // 구독 취소 이벤트
        document.getElementById('cancel-subscription-btn')?.addEventListener('click', async () => {
            if (!confirm("정말 구독을 취소하시겠습니까?")) return;

            const { data: { user } } = await supabaseClient.auth.getUser();
            const btn = document.getElementById('cancel-subscription-btn');
            btn.disabled = true;
            btn.textContent = "처리 중...";

            try {
                const response = await fetch('/api/cancel-subscription', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: user.id })
                });
                const result = await response.json();
                if (result.success) {
                    alert("구독이 취소되었습니다.");
                    window.location.reload();
                } else {
                    alert("취소 실패: " + result.error);
                }
            } catch (err) {
                alert("오류 발생: " + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = "구독 취소";
            }
        });

        if (loginButton) {
            loginButton.addEventListener('click', async () => {
                console.log("Login button clicked.");
                if (!supabaseClient) {
                    alert("Supabase configuration missing.");
                    return;
                }
                
                const { error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        queryParams: {
                            prompt: 'select_account',
                            access_type: 'offline',
                        },
                        redirectTo: window.location.origin + '/sentiment.html'
                    }
                });
                if (error) {
                    console.error('OAuth Login Error:', error.message);
                    alert("Login failed: " + error.message);
                }
            });
        }

        if (logoutButtonDropdown) {
            logoutButtonDropdown.addEventListener('click', async () => {
                console.log("Logout button clicked.");
                const { error } = await supabaseClient.auth.signOut();
                if (error) {
                    console.error('Logout Error:', error.message);
                } else {
                    console.log("Logout successful.");
                    profileDropdown.classList.add('hidden');
                    window.location.reload(); 
                }
            });
        }

        // Initialize auth state
        if (supabaseClient) {
            supabaseClient.auth.onAuthStateChange((event, session) => {
                console.log("Auth State Changed Event:", event);
                updateAuthState();
            });
            updateAuthState();
        }
    </script>
</body>
</html>