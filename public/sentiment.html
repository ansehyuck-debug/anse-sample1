<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-i18n="title-us">미국 금융시장 심리</title>
<meta name="description" content="미국 주식시장의 공포 탐욕 지수(CNN Fear & Greed Index)를 확인하고 투자에 참고하세요." data-i18n="desc-us"/>
<link rel="canonical" href="https://anse.ai.kr/sentiment.html"/>

<meta property="og:title" content="미국 금융시장 심리" data-i18n="title-us"/>
<meta property="og:description" content="미국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요." data-i18n="desc-us"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://anse.ai.kr/sentiment.html"/>
<meta property="og:image" content="https://anse.ai.kr/images/neutral.png"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="미국 금융시장 심리" data-i18n="title-us"/>
<meta name="twitter:description" content="미국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요." data-i18n="desc-us"/>
<meta name="twitter:image" content="https://anse.ai.kr/images/neutral.png"/>

<!-- Existing styles and icons -->
<link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

<!-- Tailwind CSS and Fonts -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="translations.js"></script>
<script src="i18n.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3d84f5",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101722",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'OPSZ' 24; }
        .gauge-gradient {
            background: conic-gradient(from 180deg at 50% 100%, #f87171 0deg, #fbbf24 90deg, #3d84f5 180deg);
        }
    </style>

<!-- Google Analytics and Clarity -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C8QR98TVTB');
    </script>

<script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v2qmp0i82b");
    </script>

<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "미국 금융시장 심리",
      "url": "https://anse.ai.kr/sentiment.html",
      "description": "미국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요.",
      "datePublished": "2026-01-17",
      "author": {
        "@type": "Person",
        "name": "anse"
      }
    }
    </script>

</head>
<body class="min-h-screen bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-200">
<!-- Top Navigation Bar -->
<header class="sticky top-0 z-50 w-full border-b border-solid border-[#e7ecf4] dark:border-[#1e293b] bg-white/80 dark:bg-background-dark/80 backdrop-blur-md">
<div class="mx-auto flex max-w-[1200px] items-center justify-between px-3 py-3 md:px-6">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3">
<div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary shrink-0">
<span class="material-symbols-outlined text-[20px] text-white">leaderboard</span>
</div>
<h2 class="text-lg font-bold tracking-tight dark:text-white">US Fear &amp; Greed</h2>
</div>
<div class="hidden md:flex items-center gap-6"> <!-- Desktop Nav -->
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html" data-i18n="nav-korea">한국 금융시장 심리</a>
<a class="text-sm font-semibold text-primary" href="/sentiment.html" data-i18n="nav-us">미국 금융 시장 심리</a>
</div>
</div>
<div class="flex flex-wrap items-center justify-end gap-2 md:gap-4">
<button id="menu-button" class="flex md:hidden h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined dark:text-white">menu</span>
</button>

<button id="theme-switcher" class="flex h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined dark:text-white">light_mode</span>
</button>
<div id="auth-container" class="flex items-center gap-2">
    <button id="login-button" class="hidden flex h-10 px-4 items-center justify-center rounded-lg bg-primary text-white font-bold hover:opacity-90 transition-opacity" data-i18n="login">Login</button>
    <div id="user-profile" class="hidden flex items-center gap-3">
        <div id="user-avatar" class="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/20" data-alt="User profile avatar"></div>
        <button id="logout-button" class="text-xs font-bold text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" data-i18n="logout">Logout</button>
    </div>
</div>
</div>
</div>
<div id="mobile-menu" class="md:hidden hidden bg-white/80 dark:bg-background-dark/80 backdrop-blur-md pb-4 border-b border-solid border-[#e7ecf4] dark:border-[#1e293b]">
<nav class="flex flex-col items-center gap-4 py-2">
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html" data-i18n="nav-korea">한국 금융시장 심리</a>
<a class="text-sm font-semibold text-primary" href="/sentiment.html" data-i18n="nav-us">미국 금융 시장 심리</a>
</nav>
</div>
</header>
<main class="mx-auto max-w-[1200px] px-6 py-8">
<!-- Page Heading -->
<div class="mb-8 flex flex-wrap items-end justify-between gap-8">
<div class="flex flex-col gap-1">
<h1 class="text-3xl font-black tracking-tight dark:text-white" data-i18n="title-us">US Market Sentiment</h1>
<p class="text-base text-[#49699c] dark:text-slate-400" data-i18n="us-sentiment-analysis-desc">CNN Business Fear &amp; Greed Index analysis.</p>
</div>
<div id="market-status-indicator" class="flex items-center gap-2 rounded-full bg-slate-100 dark:bg-slate-800 px-6 py-2 text-xs font-bold text-slate-600 dark:text-slate-400">
    <span id="market-status-dot" class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
    <span id="market-status-text" data-i18n="updating">Updating...</span>
</div>
<div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
<!-- Main Gauge Section -->
<div class="lg:col-span-8">
<div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
<div class="mb-4 flex flex-wrap items-center justify-between gap-3">
<h3 class="text-lg font-bold" data-i18n="current-sentiment">Current Sentiment</h3>
<span id="last-updated-time" class="text-sm font-medium text-[#49699c]"><span data-i18n="last-updated">Last updated</span>: -</span>
</div>
<div class="relative flex flex-col items-center py-10">
<!-- Gauge visualization -->
<div class="relative h-48 w-80 overflow-hidden rounded-t-full bg-slate-100 dark:bg-slate-800">
<!-- Gauge segments colored with conic gradient -->
<div class="absolute inset-0 gauge-gradient opacity-80" style="clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);"></div>
<div class="absolute bottom-0 left-1/2 h-32 w-64 -translate-x-1/2 rounded-t-full bg-white dark:bg-[#161f2c]"></div>
<!-- Needle -->
<div class="absolute bottom-0 left-1/2 h-40 w-1 -translate-x-1/2 origin-bottom transition-transform duration-1000 ease-out" id="gauge-needle">
<div class="h-full w-full bg-slate-900 dark:bg-white rounded-full"></div>
<div class="absolute -bottom-2 left-1/2 h-4 w-4 -translate-x-1/2 rounded-full bg-slate-900 dark:bg-white"></div>
</div>
</div>
<div class="mt-6 flex flex-col items-center gap-1">
<span id="score" class="text-5xl font-black text-primary"></span>
<span id="status" class="text-2xl font-bold tracking-tight text-primary" data-i18n="loading">LOADING</span>
</div>
<div class="mt-10 flex flex-wrap w-full justify-between px-4 gap-3">
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-red-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-fear">Extreme Fear</span>
</div>
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-yellow-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="neutral">Neutral</span>
</div>
<div class="flex flex-col items-center md:items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-primary"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase" data-i18n="extreme-greed">Extreme Greed</span>
</div>
</div>
</div>
</div>

<!-- Advice/Quote Section -->
<div class="mt-8 flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
<div class="mb-4 flex items-center justify-between gap-2">
<h3 class="text-lg font-bold" data-i18n="market-indicators">Market Analysis</h3>
</div>
<div id="sentiment-quote-display" class="flex flex-col gap-4">
    <p id="sentiment-quote" class="text-sm dark:text-slate-200" data-i18n="updating">데이터를 불러오는 중...</p>
</div>
</div>
</div>

<!-- Historical Comparisons & Side Metrics -->
<div class="lg:col-span-4 flex flex-col gap-6">
<!-- Proverb Card -->
<div class="flex flex-col gap-4 rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
         <h4 class="text-sm font-bold text-[#49699c] uppercase tracking-wider mb-4" data-i18n="today-proverb">오늘의 주식 시장 격언</h4>
        <p id="proverb-text" class="italic text-base text-gray-800 dark:text-gray-200 min-h-[50px] flex items-center justify-center text-center break-keep" style="white-space: pre-wrap;"></p>
        <button id="generate-proverb" class="mt-4 rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary hover:bg-primary/20 transition-colors" data-i18n="new-proverb">새 격언 확인하기</button>
</div>

<!-- US Market Indices (Static or Placeholder) -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-primary text-white p-6 shadow-sm">
<div class="flex items-center justify-between mb-4">
<h4 class="text-sm font-bold uppercase tracking-wider">S&amp;P 500</h4>
<a href="https://www.google.com/finance/quote/.INX:INDEXSP" target="_blank"><span class="material-symbols-outlined">insights</span></a>
</div>
<div class="flex flex-col gap-1">
<p id="market-index-value" class="text-3xl font-black" data-i18n="view-online">View Online</p>
<p class="text-xs text-white/70 mt-2" data-i18n="click-to-chart">Click icon to see real-time chart</p>
</div>
</div>

<div class="flex flex-wrap gap-4">
    <button id="how-calculated-button" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
    <span class="material-symbols-outlined text-[18px] dark:text-white">help_outline</span>
                            <span data-i18n="how-calculated">How it's calculated</span>
                        </button>
    <button id="download-btn" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
    <span class="material-symbols-outlined text-[18px] dark:text-white">download</span>
                            <span data-i18n="export-data">Export Data</span>
                        </button>
    </div>
</div>
</div>
</div>

<div id="indicator-explanation-section" style="display: none;" class="mt-8">
<h2 class="text-2xl font-bold mb-4 dark:text-white" data-i18n="how-calculated">지표별 계산 방식 (CNN Fear &amp; Greed)</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-1-title">1. 주가 모멘텀 (Stock Price Momentum)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-1-desc">S&amp;P 500 지수와 125일 이동평균선을 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-2-title">2. 주가 강도 (Stock Price Strength)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-2-desc">52주 신고가와 신저가 종목 수를 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-3-title">3. 주가 폭 (Stock Price Breadth)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-3-desc">상승 종목과 하락 종목의 거래량을 분석합니다. (McClellan Summation Index)</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-4-title">4. 풋/콜 옵션 (Put and Call Options)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-4-desc">풋 옵션과 콜 옵션의 거래량 비율을 측정합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-5-title">5. 시장 변동성 (Market Volatility)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-5-desc">VIX 지수와 50일 이동평균선을 비교합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-6-title">6. 안전 자산 수요 (Safe Haven Demand)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-6-desc">주식 수익률과 국채 수익률의 차이를 분석합니다.</p>
    </div>
    <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
        <h3 class="text-lg font-bold mb-2" data-i18n="us-exp-7-title">7. 정크 본드 수요 (Junk Bond Demand)</h3>
        <p class="text-sm text-[#49699c] dark:text-slate-400" data-i18n="us-exp-7-desc">투자 등급 채권과 투기 등급 채권의 수익률 스프레드를 분석합니다.</p>
    </div>
</div>
</div>


<!-- Footer -->
<footer class="mt-12 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-8 pb-12">
<div class="flex flex-wrap items-center justify-between gap-6 text-[#49699c] dark:text-slate-500">
<div class="flex flex-col gap-2">
<p class="text-sm font-medium dark:text-white" data-i18n="footer-desc-us">Data provided by CNN Business.</p>
<p class="max-w-md text-xs leading-relaxed dark:text-white" data-i18n="fng-theory">The Fear &amp; Greed Index is a way to gauge stock market movements and whether stocks are fairly priced. CNN examines seven different factors to establish how much fear and greed there is in the market.</p>
</div>
<div class="flex gap-4">
    <a href="/privacy.html" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
    <span class="material-symbols-outlined text-[18px] dark:text-white">policy</span>
                            <span data-i18n="privacy-policy">개인정보처리방침</span>
                        </a>
    </div>
</div>
</footer>
</main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      // Firebase initialization
      const firebaseConfig = {
        apiKey: "AIzaSyBumYJj1X1KrjwjWTZhGuO0B-xZJj1fLsE",
        authDomain: "anse-sample1-46739525-2d1c0.firebaseapp.com",
        projectId: "anse-sample1-46739525-2d1c0",
        storageBucket: "anse-sample1-46739525-2d1c0.firebasestorage.app",
        messagingSenderId: "164266713411",
        appId: "1:164266713411:web:31e470b1a7320aa6028ff6"
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.firestore();

        // Update gauge
        function updateGauge(score) {
            const needle = document.getElementById('gauge-needle');
            const scoreDisplay = document.getElementById('score');
            const statusEl = document.getElementById('status');

            const rotationDegree = (score / 100) * 180 - 90;
            needle.style.transform = `translateX(-50%) rotate(${rotationDegree}deg)`;
            scoreDisplay.textContent = Math.round(score);

            let textColorClass = "";
            let statusKey = "";
            if (score <= 25) { textColorClass = "text-red-500"; statusKey = "extreme-fear"; } 
            else if (score <= 44) { textColorClass = "text-orange-500"; statusKey = "fear"; }
            else if (score <= 55) { textColorClass = "text-yellow-500"; statusKey = "neutral"; }
            else if (score <= 75) { textColorClass = "text-emerald-500"; statusKey = "greed"; }
            else { textColorClass = "text-blue-500"; statusKey = "extreme-greed"; }

            scoreDisplay.classList.remove("text-red-500", "text-orange-500", "text-yellow-500", "text-emerald-500", "text-blue-500", "text-primary");
            scoreDisplay.classList.add(textColorClass);
            statusEl.textContent = i18n.translate(statusKey).toUpperCase();
            statusEl.classList.remove("text-red-500", "text-orange-500", "text-yellow-500", "text-emerald-500", "text-blue-500", "text-primary");
            statusEl.classList.add(textColorClass);
            statusEl.removeAttribute('data-i18n'); // Prevent reset on lang change
        }

        // US Market Status (NYSE/NASDAQ)
        function updateUSMarketStatus() {
            const marketStatusText = document.getElementById('market-status-text');
            const marketStatusDot = document.getElementById('market-status-dot');
            const marketStatusIndicator = document.getElementById('market-status-indicator');

            // US Market Hours: 9:30 AM - 4:00 PM ET
            // We'll use a simple approach based on UTC
            const now = new Date();
            const utcHour = now.getUTCHours();
            const utcMinute = now.getUTCMinutes();
            const day = now.getUTCDay(); // 0: Sun, 1: Mon, ..., 6: Sat

            // Standard Time (EST): UTC-5 -> 14:30 - 21:00 UTC
            // Daylight Saving (EDT): UTC-4 -> 13:30 - 20:00 UTC
            // For simplicity, let's assume EDT (usually Mar-Nov) or just check a range
            // More robust: use Intl.DateTimeFormat
            const nyTime = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                hour: 'numeric',
                minute: 'numeric',
                hour12: false,
                weekday: 'short'
            }).formatToParts(now);

            const hourPart = nyTime.find(p => p.type === 'hour').value;
            const minutePart = nyTime.find(p => p.type === 'minute').value;
            const weekdayPart = nyTime.find(p => p.type === 'weekday').value;

            const hour = parseInt(hourPart);
            const minute = parseInt(minutePart);
            const isWeekend = weekdayPart === 'Sat' || weekdayPart === 'Sun';

            let isOpen = false;
            if (!isWeekend) {
                const totalMinutes = hour * 60 + minute;
                if (totalMinutes >= (9 * 60 + 30) && totalMinutes < (16 * 60)) {
                    isOpen = true;
                }
            }

            if (isOpen) {
                marketStatusText.textContent = i18n.translate("market-open");
                marketStatusText.removeAttribute('data-i18n'); // Prevent reset on lang change
                marketStatusDot.classList.add('bg-emerald-500', 'animate-pulse');
                marketStatusIndicator.classList.add('bg-emerald-100', 'text-emerald-600');
            } else {
                marketStatusText.textContent = i18n.translate("market-closed");
                marketStatusText.removeAttribute('data-i18n'); // Prevent reset on lang change
                marketStatusDot.classList.add('bg-red-500');
                marketStatusIndicator.classList.add('bg-slate-200/60', 'text-slate-600');
            }
        }

        async function fetchUSSentiment() {
            const quoteEl = document.getElementById('sentiment-quote');
            const lastUpdatedEl = document.getElementById('last-updated-time');

            try {
                const doc = await db.collection('market_sentiment').doc('cnn_fng').get();
                if (doc.exists) {
                    const data = doc.data();
                    const value = data.value;
                    updateGauge(value);

                    let quoteText = "";
                    if (value >= 0 && value <= 24) { quoteText = i18n.translate("quote-extreme-fear"); }
                    else if (value >= 25 && value <= 44) { quoteText = i18n.translate("quote-fear"); }
                    else if (value >= 45 && value <= 55) { quoteText = i18n.translate("quote-neutral"); }
                    else if (value >= 56 && value <= 75) { quoteText = i18n.translate("quote-greed"); }
                    else if (value >= 76 && value <= 100) { quoteText = i18n.translate("quote-extreme-greed"); }
                    else { quoteText = i18n.translate("quote-unknown"); }

                    quoteEl.textContent = quoteText;
                    
                    if (data.last_update) {
                        const currentLang = i18n.getLanguage();
                        const timeSuffix = i18n.translate("time-suffix");
                        lastUpdatedEl.textContent = `${i18n.translate("last-updated")}: ${data.last_update} ${timeSuffix}`;
                    }
                } else {
                    quoteEl.textContent = i18n.translate("preparing-advice");
                }
            } catch (error) {
                console.error("Error fetching US sentiment:", error);
                quoteEl.textContent = i18n.translate("failed-to-load-advice");
            }
        }

        const proverbs = {
            ko: [
                "“시장은 단기적으로 투표기계지만 장기적으로 저울이다.”\n→ 벤저민 그레이엄 (Benjamin Graham)",
                "“잃지 않는 것이 버는 것보다 중요하다.”\n→ 워런 버핏 (Warren Buffett)",
                "“첫 번째 규칙은 돈을 잃지 않는 것이다. 두 번째 규칙은 첫 번째 규칙을 잊지 않는 것이다.”\n→ 워런 버핏",
                "“훌륭한 기업을 적당한 가격에 사라.”\n→ 워런 버핏 / 찰리 멍거",
                "“위험은 자신이 무엇을 하고 있는지 모를 때 생긴다.”\n→ 워런 버핏",
                "“공포 속에서 사고 탐욕 속에서 팔아라.”\n→ 워런 버핏 / 월가 격언",
                "“시장은 인내심 없는 사람의 돈을 인내심 있는 사람에게서 옮겨준다.”\n→ 워런 버핏",
                "“가격은 지불하는 것이고 가치는 얻는 것이다.”\n→ 워런 버핏",
                "“이해하지 못하는 사업에는 투자하지 마라.”\n→ 워런 버핏",
                "“10년 이상 보유할 생각이 없다면 10분도 보유하지 마라.”\n→ 워런 버핏",
                "“추세는 당신의 친구다.”\n→ 제시 리버모어 (Jesse Livermore)",
                "“손실은 짧게, 이익은 길게 가져가라.”\n→ 제시 리버모어",
                "“시장은 항상 옳다.”\n→ 제시 리버모어 (의미상 격언)",
                "“강세장은 비관 속에서 태어나 회의 속에서 자라고 낙관 속에서 성숙하며 도취 속에서 죽는다.”\n→ 존 템플턴 (John Templeton)",
                "“이번엔 다르다는 말이 가장 위험하다.”\n→ 존 템플턴",
                "“기다리는 것도 포지션이다.”\n→ 월가 격언",
                "“현금도 투자다.”\n→ 월가 격언",
                "“절대 바닥에서 못 사고 꼭대기에서 못 판다.”\n→ 월가 격언",
                "“칼 떨어질 때 잡지 마라.”\n→ 월가 격언",
                "“소문에 사고 뉴스에 팔아라.”\n→ 월가 격언",
                "“모두가 같은 방향을 볼 때 위험은 커진다.”\n→ 월가 격언",
                "“시장은 당신의 감정을 시험한다.”\n→ 월가 격언",
                "“확신이 클수록 조심하라.”\n→ 월가 격언",
                "“거래가 잦을수록 수익률은 낮아진다.”\n→ 브래드 바버 & 테런스 오딘 (행동재무학 연구)",
                "“시장에 머무는 시간이 시장을 맞추는 것보다 중요하다.”\n→ 투자 격언 (Bogle 계열 인용)",
                "“복리는 세계 8대 불가사의다.”\n→ 알버트 아인슈타인 (투자 격언으로 인용)",
                "“시간은 좋은 기업의 편이다.”\n→ 워런 버핏",
                "“숫자를 보지 않고 주식을 사는 것은 계기판 없는 비행기를 타는 것과 같다.”\n→ 피터 린치 (Peter Lynch)",
                "“스토리가 아니라 실적을 사라.”\n→ 피터 린치 (의미 요약)",
                "“가장 위험한 시점은 모두가 안심할 때다.”\n→ 하워드 막스 (Howard Marks)",
                "“리스크는 변동성이 아니라 영구적 자본 손실이다.”\n→ 하워드 막스",
                "“좋은 투자란 나쁜 시나리오에서도 버티는 것이다.”\n→ 하워드 막스",
                "“높은 수익은 높은 불편함에서 나온다.”\n→ 하워드 막스",
                "“시장은 과잉 반응한다.”\n→ 로버트 실러 (Robert Shiller)",
                "“분산투자는 무지를 인정하는 행위다.”\n→ 워런 버핏",
                "“가장 좋은 매수 시점은 모두가 팔고 싶을 때다.”\n→ 월가 격언",
                "“싸게 사는 것이 수익의 절반이다.”\n→ 벤저민 그레이엄",
                "“시장은 언제나 과도하게 낙관적이거나 비관적이다.”\n→ 벤저민 그레이엄",
                "“손절은 선택이 아니라 생존이다.”\n→ 트레이더 격언",
                "“포트폴리오는 수익이 아니라 리스크로 관리하라.”\n→ 레이 달리오 (Ray Dalio)",
                "“미래를 예측하지 말고 대비하라.”\n→ 레이 달리오",
                "“좋은 투자자는 예측보다 원칙에 의존한다.”\n→ 레이 달리오",
                "“시장은 합리적이지 않을 수 있다, 하지만 오래 비합리적이진 않다.”\n→ 존 메이너드 케인즈 (John M. Keynes)",
                "“시장은 당신이 파산하기 전에 비이성적으로 남아 있을 수 있다.”\n→ 존 메이너드 케인즈",
                "“레버리지는 실수를 치명적으로 만든다.”\n→ 월가 격언",
                "“수익은 인내에서 나오고 손실은 조급함에서 나온다.”\n→ 월가 격언",
                "“완벽한 타이밍은 없다.”\n→ 투자 격언",
                "“하락장은 나쁜 기업을 드러낸다.”\n→ 월가 격언",
                "“좋은 기업은 위기에서 더 강해진다.”\n→ 워런 버핏 (의미 인용)",
                "“투자에서 가장 중요한 단어는 ‘영원히’가 아니라 ‘충분히 오래’다.”\n→ 하워드 막스 (의미 인용)"
            ],
            en: [
                "“In the short run, the market is a voting machine but in the long run, it is a weighing machine.”\n→ Benjamin Graham",
                "“It's not whether you're right or wrong that's important, but how much money you make when you're right and how much you lose when you're wrong.”\n→ Warren Buffett",
                "“Rule No. 1: Never lose money. Rule No. 2: Never forget rule No. 1.”\n→ Warren Buffett",
                "“It's far better to buy a wonderful company at a fair price than a fair company at a wonderful price.”\n→ Warren Buffett / Charlie Munger",
                "“Risk comes from not knowing what you're doing.”\n→ Warren Buffett",
                "“Be fearful when others are greedy and greedy when others are fearful.”\n→ Warren Buffett",
                "“The stock market is a device for transferring money from the impatient to the patient.”\n→ Warren Buffett",
                "“Price is what you pay. Value is what you get.”\n→ Warren Buffett",
                "“Never invest in a business you cannot understand.”\n→ Warren Buffett",
                "“If you aren't willing to own a stock for ten years, don't even think about owning it for ten minutes.”\n→ Warren Buffett",
                "“The trend is your friend.”\n→ Jesse Livermore",
                "“Cut your losses short and let your profits run.”\n→ Jesse Livermore",
                "“Markets are never wrong – opinions often are.”\n→ Jesse Livermore",
                "“Bull markets are born on pessimism, grown on skepticism, mature on optimism and die on euphoria.”\n→ John Templeton",
                "“The four most dangerous words in investing are: 'This time it's different.'”\n→ John Templeton",
                "“Waiting is also a position.”\n→ Wall Street Proverb",
                "“Cash is also an investment.”\n→ Wall Street Proverb",
                "“You can't buy at the very bottom or sell at the very top.”\n→ Wall Street Proverb",
                "“Don't try to catch a falling knife.”\n→ Wall Street Proverb",
                "“Buy the rumor, sell the news.”\n→ Wall Street Proverb",
                "“When everyone is looking in the same direction, risk increases.”\n→ Wall Street Proverb",
                "“The market will test your emotions.”\n→ Wall Street Proverb",
                "“The more certain you are, the more cautious you should be.”\n→ Wall Street Proverb",
                "“The more active the trader, the less money they make.”\n→ Brad Barber & Terence Odean",
                "“Time in the market beats timing the market.”\n→ Investment Proverb",
                "“Compound interest is the eighth wonder of the world.”\n→ Albert Einstein",
                "“Time is the friend of the wonderful company, the enemy of the mediocre.”\n→ Warren Buffett",
                "“Investing without looking at the numbers is like driving a car without a dashboard.”\n→ Peter Lynch",
                "“Buy the business, not the story.”\n→ Peter Lynch",
                "“The most dangerous time is when everyone feels safe.”\n→ Howard Marks",
                "“Risk is not volatility; it is the permanent loss of capital.”\n→ Howard Marks",
                "“Good investing is about surviving the bad scenarios.”\n→ Howard Marks",
                "“High returns come from high discomfort.”\n→ Howard Marks",
                "“Markets overreact in both directions.”\n→ Robert Shiller",
                "“Diversification is protection against ignorance.”\n→ Warren Buffett",
                "“The best time to buy is when everyone wants to sell.”\n→ Wall Street Proverb",
                "“Buying cheap is half the profit.”\n→ Benjamin Graham",
                "“Markets are always either too optimistic or too pessimistic.”\n→ Benjamin Graham",
                "“Cutting losses is not a choice, it is survival.”\n→ Trader Proverb",
                "“Manage risk, not returns.”\n→ Ray Dalio",
                "“Don't predict the future, prepare for it.”\n→ Ray Dalio",
                "“Successful investors rely on principles, not predictions.”\n→ Ray Dalio",
                "“The market can be irrational, but it won't stay irrational forever.”\n→ John Maynard Keynes",
                "“The market can remain irrational longer than you can remain solvent.”\n→ John Maynard Keynes",
                "“Leverage makes mistakes fatal.”\n→ Wall Street Proverb",
                "“Profits come from patience, losses come from haste.”\n→ Wall Street Proverb",
                "“There is no such thing as perfect timing.”\n→ Investment Proverb",
                "“Bear markets reveal bad companies.”\n→ Wall Street Proverb",
                "“Wonderful companies become stronger through a crisis.”\n→ Warren Buffett",
                "“In investing, the most important word is not 'forever', but 'long enough'.”\n→ Howard Marks"
            ]
        };

        function displayRandomProverb() {
            const proverbText = document.getElementById('proverb-text');
            if (proverbText) {
                const currentLang = i18n.getLanguage();
                const list = proverbs[currentLang] || proverbs.en;
                const randomIndex = Math.floor(Math.random() * list.length);
                proverbText.textContent = list[randomIndex];
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Theme switcher
            const themeSwitcher = document.getElementById('theme-switcher');
            themeSwitcher.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                const icon = themeSwitcher.querySelector('.material-symbols-outlined');
                icon.textContent = isDarkMode ? 'dark_mode' : 'light_mode';
            });
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                themeSwitcher.querySelector('.material-symbols-outlined').textContent = 'dark_mode';
            }

            // Mobile menu
            document.getElementById('menu-button').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            fetchUSSentiment();
            updateUSMarketStatus();
            displayRandomProverb();
            document.getElementById('generate-proverb').addEventListener('click', displayRandomProverb);

            document.getElementById('how-calculated-button').addEventListener('click', () => {
                const section = document.getElementById('indicator-explanation-section');
                const isOpening = section.style.display === 'none';
                if (isOpening) {
                    section.style.display = 'block';
                    // Small timeout to ensure DOM has rendered the block before scrolling
                    setTimeout(() => {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 10);
                } else {
                    section.style.display = 'none';
                }
            });

            document.getElementById('download-btn').addEventListener('click', function() {
                html2canvas(document.querySelector('main'), { scale: 2 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'us_sentiment_report.png';
                    link.href = canvas.toDataURL();
                    link.click();
                });
            });

            // Listen for language changes to refresh dynamic content
            window.addEventListener('languageChanged', () => {
                fetchUSSentiment();
                updateUSMarketStatus();
                displayRandomProverb();
            });
        });
    </script>
    <script>
        // Supabase configuration
        // Values will be replaced by Cloudflare build/deployment environment
        const SB_URL = 'SUPABASE_URL';
        const SB_KEY = 'SUPABASE_ANON_KEY';
        
        let supabaseClient;
        try {
            console.log("Initializing Supabase (Sentiment Page)...");
            if (SB_URL === 'SUPABASE_URL' || !SB_URL.startsWith('http')) {
                throw new Error("Supabase URL is not properly configured in environment variables.");
            }
            const { createClient } = supabase;
            supabaseClient = createClient(SB_URL, SB_KEY);
            console.log("Supabase Client initialized successfully.");
        } catch (e) {
            console.error("Supabase Initialization Error:", e.message);
            console.info("Falling back: Login functionality may be disabled until environment variables are correctly injected.");
            // Ensure login button is visible to show error on click
            const btn = document.getElementById('login-button');
            if (btn) btn.classList.remove('hidden');
        }

        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const userProfile = document.getElementById('user-profile');
        const userAvatar = document.getElementById('user-avatar');

        async function updateAuthState() {
            if (!supabaseClient) {
                console.warn("updateAuthState called but supabaseClient is not initialized.");
                return;
            }
            
            try {
                const { data: { user }, error } = await supabaseClient.auth.getUser();
                if (error) throw error;
                
                if (user) {
                    console.log("User is logged in:", user.email);
                    loginButton.classList.add('hidden');
                    userProfile.classList.remove('hidden');
                    if (user.user_metadata.avatar_url) {
                        userAvatar.style.backgroundImage = `url('${user.user_metadata.avatar_url}')`;
                    }
                } else {
                    console.log("No user session found.");
                    loginButton.classList.remove('hidden');
                    userProfile.classList.add('hidden');
                }
            } catch (err) {
                console.error("Auth State Update Error:", err.message);
                loginButton.classList.remove('hidden');
                userProfile.classList.add('hidden');
            }
        }

        if (loginButton) {
            loginButton.addEventListener('click', async () => {
                console.log("Login button clicked.");
                if (!supabaseClient) {
                    const msg = "Supabase configuration missing. Please ensure SUPABASE_URL and SUPABASE_ANON_KEY are set in Cloudflare.";
                    console.error(msg);
                    alert(msg);
                    return;
                }
                
                const { error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/sentiment.html'
                    }
                });
                if (error) {
                    console.error('OAuth Login Error:', error.message);
                    alert("Login failed: " + error.message);
                }
            });
        }

        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                console.log("Logout button clicked.");
                if (!supabaseClient) return;
                const { error } = await supabaseClient.auth.signOut();
                if (error) {
                    console.error('Logout Error:', error.message);
                } else {
                    console.log("Logout successful.");
                    updateAuthState();
                }
            });
        }

        // Initialize auth state
        if (supabaseClient) {
            supabaseClient.auth.onAuthStateChange((event, session) => {
                console.log("Auth State Changed Event:", event);
                updateAuthState();
            });
            updateAuthState();
        }
    </script>
</body>
</html>