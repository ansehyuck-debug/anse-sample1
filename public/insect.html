<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나는 어떤 곤충상일까? - 곤충상 테스트</title>
    <meta name="description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <link rel="canonical" href="https://anse-sample1.pages.dev/insect.html">

    <meta property="og:title" content="나는 어떤 곤충상일까? - 곤충상 테스트">
    <meta property="og:description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anse-sample1.pages.dev/insect.html">
    <meta property="og:image" content="https://anse-sample1.pages.dev/favicon.svg">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="나는 어떤 곤충상일까? - 곤충상 테스트">
    <meta property="twitter:description" content="AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.">
    <meta property="twitter:image" content="https://anse-sample1.pages.dev/favicon.svg">

    <!-- Styles from korea-sentiment.html -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

    <!-- Tailwind CSS and Fonts from korea-sentiment.html -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            "primary": "#3d84f5",
                            "background-light": "#f5f7f8",
                            "background-dark": "#101722",
                        },
                        fontFamily: {
                            "display": ["Inter", "sans-serif"]
                        },
                        borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                    },
                },
            }
        </script>
    <style>
            body { font-family: 'Inter', sans-serif; }
            .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'OPSZ' 24; }
            .gauge-gradient {
                background: conic-gradient(from 180deg at 50% 100%, #f87171 0deg, #fbbf24 90deg, #3d84f5 180deg);
            }
            .image-preview-container {
                max-width: 100%; /* Max width */
                width: 20em; /* Responsive width */
                height: 20em; /* Maintain aspect ratio */
                margin: 20px auto; /* Center the image preview */
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                display: flex; /* Use flexbox to center image vertically/horizontally */
                justify-content: center;
                align-items: center;
                background-color: theme('colors.white'); /* Placeholder background */
            }
            html.dark .image-preview-container {
                background-color: theme('colors.slate.800');
            }
            .image-preview-container img {
                max-width: 100%; /* Ensure image fits container */
                max-height: 100%;
                object-fit: contain; /* Contain the entire image */
                display: block;
            }
            .prediction-graph {
                margin-top: 30px;
                width: 100%;
                max-width: 500px;
                text-align: left;
                margin-left: auto;
                margin-right: auto;
            }
            .prediction-bar-container {
                display: flex;
                align-items: center;
                margin-bottom: 8px;
                font-size: 0.9em;
                color: theme('colors.slate.900');
            }
            html.dark .prediction-bar-container {
                color: theme('colors.slate.200');
            }
            .prediction-bar-label {
                flex-basis: 120px;
                margin-right: 10px;
                font-weight: bold;
            }
            .prediction-bar {
                flex-grow: 1;
                height: 20px;
                background-color: theme('colors.gray.200');
                border-radius: 3px;
                position: relative;
                overflow: hidden;
            }
            html.dark .prediction-bar {
                background-color: theme('colors.gray.700');
            }
            .prediction-bar-fill {
                height: 100%;
                background: linear-gradient(90deg, theme('colors.emerald.200'), theme('colors.emerald.500'));
                transition: width 0.5s ease-out;
                display: flex;
                align-items: center;
                justify-content: flex-end;
                padding-right: 5px;
                color: theme('colors.slate.900');
                font-size: 0.8em;
                box-sizing: border-box;
            }
            html.dark .prediction-bar-fill {
                color: theme('colors.slate.200');
            }
            .insect-features {
                margin-top: 30px;
                text-align: left;
                padding: 20px;
                background-color: theme('colors.white');
                border-radius: 10px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            html.dark .insect-features {
                background-color: theme('colors.slate.800');
            }
            .insect-features h3 {
                text-align: center;
                color: theme('colors.emerald.700');
            }
            .insect-features p {
                font-size: 1em;
                line-height: 1.8;
            }
        </style>
    <!-- Teachable Machine scripts specific to insect.html -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <!-- Google Analytics and Clarity scripts from korea-sentiment.html -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-C8QR98TVTB');
    </script>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v2qmp0i82b");
    </script>
    <!-- LD+JSON script from insect.html -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "곤충상 테스트",
      "url": "https://anse-sample1.pages.dev/insect.html",
      "description": "AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.",
      "applicationCategory": "Entertainment",
      "operatingSystem": "Any",
      "browserRequirements": "Requires HTML5 support"
    }
    </script>
</head>
<body class="min-h-screen bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-200">
    <div id="root">
<!-- Header from korea-sentiment.html, adjusted for insect.html -->
<header class="sticky top-0 z-50 w-full border-b border-solid border-[#e7ecf4] dark:border-[#1e293b] bg-white/80 dark:bg-background-dark/80 backdrop-blur-md">
<div class="mx-auto flex max-w-[1200px] items-center justify-between px-6 py-3">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3">
<div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary">
<span class="material-symbols-outlined text-[20px] text-white">bug_report</span>
</div>
<h2 class="text-lg font-bold tracking-tight dark:text-white">곤충상 테스트</h2>
</div>
<nav class="hidden md:flex items-center gap-6">
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/korea-sentiment.html">한국 금융시장 심리</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html">오늘 저녁 뭐 먹지?</a>
<a class="text-sm font-semibold text-primary" href="/insect.html">곤충상 테스트</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/about-insect.html">곤충상이란?</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/sentiment.html">미국 금융 시장 심리</a>
</nav>
</div>
<div class="flex items-center gap-4">

<button id="theme-switcher" class="flex h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined">light_mode</span>
</button>
<button class="flex h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined">notifications</span>
</button>
<div class="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/20" data-alt="User profile avatar" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBneBh9BK99BKx2b26Ln0wWAXSWA-NkKD-lrrv98lVK_rJdPXTgQuGmdvqczD3UIKISPcMnzpf-BQOdedWBnyulZOQWc1ciJwX7DT6PMhaFrVawJq4F6y18XmDN29W32bH_6CzaUWabwqtdTvTlUIGfSvw74jtRHl327xyGMcu_5I55ABKEDpKDaOoVeIFo8NUFPEGK3dONKg3bls3I7AJT26lh-N-OCbGYRo4N6cdwNSvECRXQfW82pZjHea9vnYNYvU8yp9ZTwnIf')"></div>
</div>
</div>
</header>
    <main class="mx-auto max-w-[1200px] px-6 py-8">
        <div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
            <div class="lg:col-span-12">
                <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
                    <article>
                        <h2 class="text-lg font-bold">나는 어떤 곤충상일까?</h2>
                        <p>AI가 당신의 얼굴 사진을 분석하여 당신의 곤충상을 찾아드립니다. 지금 바로 테스트해보세요!</p>
                        
                        <div class="button-group">
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <button onclick="document.getElementById('imageUpload').click()" class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white hover:opacity-80 transition-colors">사진 업로드</button>
                            <button id="checkResult" class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white hover:opacity-80 transition-colors" style="margin-left: 10px;">결과 확인하기</button>
                        </div>
                        
                        <div id="imagePreview" class="image-preview-container">
                            <!-- Uploaded image preview will be displayed here -->
                        </div>

                        <div id="result" style="margin-top: 20px; font-size: 1.8em; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">
                            여기에 결과가 표시됩니다.
                        </div>
                        <p style="text-align: center; font-size: 0.9em; color: var(--text-color-dark); margin-top: 10px;">※사진은 저장되지 않습니다.</p>
                        <button id="resetButton" class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white hover:opacity-80 transition-colors" style="margin-top: 10px;">다시하기</button>


                        <div id="predictionGraph" class="prediction-graph">
                            <!-- Prediction graph will be displayed here -->
                        </div>

                        <div id="insectFeatures" class="insect-features" style="display: none;">
                            <!-- Insect features will be displayed here -->
                        </div>
                    </article>
                </div>
            </div>

            <div class="lg:col-span-12 mt-8">
                <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
                    <div class="contact-section">
                        <h2 class="text-lg font-bold">제휴 문의</h2>
                        <form action="https://formspree.io/f/mlggrwrk" method="POST">
                            <input type="text" name="name" placeholder="이름" required>
                            <input type="email" name="email" placeholder="이메일" required>
                            <textarea name="message" placeholder="내용" required></textarea>
                            <button type="submit" class="rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white hover:opacity-80 transition-colors">보내기</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-12 mt-8">
                <div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
                    <div id="disqus_thread"></div>
                </div>
            </div>
        </div>
    </main>
<!-- Footer from korea-sentiment.html, adjusted for insect.html -->
<footer class="mt-12 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-8 pb-12">
<div class="flex flex-wrap items-center justify-between gap-6 text-[#49699c] dark:text-slate-500">
<div class="flex flex-col gap-2">
<p class="text-sm font-medium">AI가 당신의 얼굴을 분석하여 어떤 곤충상에 가까운지 알려드립니다.</p>
<p class="max-w-md text-xs leading-relaxed">본 테스트는 재미를 목적으로 하며, 결과는 과학적 근거가 없습니다.</p>
</div>
<div class="flex gap-4">
<a href="/privacy.html" class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
<span class="material-symbols-outlined text-[18px]">policy</span>
                        개인정보처리방침
                    </a>
</div>
</div>
</footer>

    <script type="text/javascript">
        // Theme switcher logic
        const themeSwitcher = document.getElementById('theme-switcher');
        const updateThemeIcon = (isDarkMode) => {
            const icon = document.querySelector('#theme-switcher .material-symbols-outlined');
            if (icon) {
                icon.textContent = isDarkMode ? 'dark_mode' : 'light_mode';
            }
        };

        const applySavedTheme = () => {
            const savedTheme = localStorage.getItem('theme');
            const isDarkMode = savedTheme === 'dark';
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                updateThemeIcon(true);
            } else {
                document.documentElement.classList.remove('dark');
                updateThemeIcon(false);
            }
        };

        if (themeSwitcher) {
            themeSwitcher.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                if (isDarkMode) {
                    localStorage.setItem('theme', 'dark');
                } else {
                    localStorage.removeItem('theme');
                }
                updateThemeIcon(isDarkMode);
            });
        }
        
        // Initial theme application on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', applySavedTheme);


        const URL = "https://teachablemachine.withgoogle.com/models/_oRwiza95/";
        let model, maxPredictions;

        const insectDescriptions = {
            "개미": "부지런하고 협동심이 강한 인상을 줍니다. 목표 지향적이고 현실적인 성향을 가집니다.",
            "벌": "활발하고 에너지가 넘치며, 리더십 있는 모습을 보입니다. 사회성이 뛰어나고 책임감이 강합니다.",
            "나비": "아름답고 섬세하며, 자유로운 영혼을 가진 인상을 줍니다. 예술적 감각이 뛰어나고 변화를 즐깁니다.",
            "사마귀": "날카롭고 카리스마 있는 인상을 줍니다. 집중력이 좋고 목표를 향해 끈기 있게 나아가는 성향이 있습니다.",
            "무당벌레": "귀엽고 친근하며, 긍정적인 에너지를 발산합니다. 주변 사람들에게 행복을 주는 유쾌한 성격입니다.",
            "장수풍뎅이": "튼튼하고 묵직한 인상을 주며, 강인함과 안정감을 가집니다. 신뢰할 수 있고 든든한 타입입니다."
        };

        // Load the image model
        async function initModel() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                console.log("Teachable Machine model loaded successfully.");
            } catch (error) {
                console.error("Failed to load Teachable Machine model:", error);
                document.getElementById('result').textContent = '모델 로드 실패. 콘솔을 확인하세요.';
            }
        }

        // Call initModel when the window loads
        window.addEventListener('load', initModel);

        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const resultDiv = document.getElementById('result');
            const predictionGraphDiv = document.getElementById('predictionGraph');
            const insectFeaturesDiv = document.getElementById('insectFeatures');

            // Clear previous results
            resultDiv.textContent = '여기에 결과가 표시됩니다.'; // Reset to initial text
            predictionGraphDiv.innerHTML = '';
            insectFeaturesDiv.innerHTML = '';
            insectFeaturesDiv.style.display = 'none';

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    document.getElementById('imagePreview').innerHTML = '';
                    document.getElementById('imagePreview').appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('checkResult').addEventListener('click', async function() {
            const resultDiv = document.getElementById('result');
            const imagePreviewDiv = document.getElementById('imagePreview');
            const uploadedImageElement = imagePreviewDiv.querySelector('img');
            const predictionGraphDiv = document.getElementById('predictionGraph');
            const insectFeaturesDiv = document.getElementById('insectFeatures');

            predictionGraphDiv.innerHTML = ''; // Clear previous graph
            insectFeaturesDiv.innerHTML = ''; // Clear previous features
            insectFeaturesDiv.style.display = 'none'; // Hide features initially

            if (!uploadedImageElement) {
                resultDiv.textContent = '사진을 먼저 업로드해주세요!';
                return;
            }

            if (!model) {
                resultDiv.textContent = 'AI 모델 로딩 중입니다. 잠시 후 다시 시도해주세요.';
                await initModel(); 
                if (!model) {
                    resultDiv.textContent = 'AI 모델 로드에 실패했습니다. 페이지를 새로고침하거나 나중에 다시 시도해주세요.';
                    return;
                }
            }

            resultDiv.textContent = 'AI가 당신의 곤충상을 분석 중입니다...';

            try {
                // Create a canvas from the uploaded image for prediction
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                // Ensure canvas size matches the model's expected input size (e.g., 224x224 from Teachable Machine defaults)
                const modelInputSize = 224; 
                canvas.width = modelInputSize;
                canvas.height = modelInputSize;
                ctx.drawImage(uploadedImageElement, 0, 0, modelInputSize, modelInputSize);


                const prediction = await model.predict(canvas);
                
                let highestProbability = 0;
                let predictedInsect = '알 수 없음';

                // Display graph and find highest probability
                prediction.forEach(p => {
                    const barContainer = document.createElement('div');
                    barContainer.className = 'prediction-bar-container';

                    const labelSpan = document.createElement('span');
                    labelSpan.className = 'prediction-bar-label';
                    labelSpan.textContent = p.className;

                    const barOuter = document.createElement('div');
                    barOuter.className = 'prediction-bar';

                    const barFill = document.createElement('div');
                    barFill.className = 'prediction-bar-fill';
                    barFill.style.width = `${p.probability * 100}%`;
                    barFill.textContent = `${(p.probability * 100).toFixed(1)}%`;

                    barOuter.appendChild(barFill);
                    barContainer.appendChild(labelSpan);
                    barContainer.appendChild(barOuter);
                    predictionGraphDiv.appendChild(barContainer);

                    if (p.probability > highestProbability) {
                        highestProbability = p.probability;
                        predictedInsect = p.className;
                    }
                });
                
                resultDiv.textContent = `당신은 ${predictedInsect}입니다!`;

                // Display insect features
                const description = insectDescriptions[predictedInsect] || "해당 곤충상에 대한 설명이 없습니다.";
                insectFeaturesDiv.innerHTML = `<h3>${predictedInsect} 특징</h3><p>${description}</p>`;
                insectFeaturesDiv.style.display = 'block';

            } catch (error) {
                console.error("Prediction failed:", error);
                resultDiv.textContent = '분석 중 오류가 발생했습니다. 콘솔을 확인하세요.';
            }
        });
        
        document.getElementById('resetButton').addEventListener('click', function() {
            const imagePreviewDiv = document.getElementById('imagePreview');
            const resultDiv = document.getElementById('result');
            const predictionGraphDiv = document.getElementById('predictionGraph');
            const insectFeaturesDiv = document.getElementById('insectFeatures');
            const imageUploadInput = document.getElementById('imageUpload');

            // Clear image preview
            imagePreviewDiv.innerHTML = '';
            
            // Clear results
            resultDiv.textContent = '여기에 결과가 표시됩니다.';
            predictionGraphDiv.innerHTML = '';
            insectFeaturesDiv.innerHTML = '';
            insectFeaturesDiv.style.display = 'none';

            // Reset file input value
            imageUploadInput.value = '';
        });

        // Disqus configuration (remains unchanged)
        var disqus_config = function () {
            this.page.url = 'https://anse-sample1.pages.dev/insect.html';
            this.page.identifier = 'https://anse-sample1.pages.dev/insect.html';
        };
        (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://ansebooktv.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</body>
</html>