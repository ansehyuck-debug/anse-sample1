<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>국내 금융시장 심리 - 오늘 저녁 뭐 먹지?</title> <!-- Keep original title -->
<meta name="description" content="한국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요."/> <!-- Keep original description -->
<link rel="canonical" href="https://anse-sample1.pages.dev/korea-sentiment.html"/> <!-- Keep original canonical -->

<meta property="og:title" content="국내 금융시장 심리 - 오늘 저녁 뭐 먹지?"/> <!-- Keep original og tags -->
<meta property="og:description" content="한국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요."/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://anse-sample1.pages.dev/korea-sentiment.html"/>
<meta property="og:image" content="https://anse-sample1.pages.dev/images/neutral.png"/>

<meta name="twitter:card" content="summary"/> <!-- Keep original twitter tags -->
<meta name="twitter:title" content="국내 금융시장 심리 - 오늘 저녁 뭐 먹지?"/>
<meta name="twitter:description" content="한국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요."/>
<meta name="twitter:image" content="https://anse-sample1.pages.dev/images/neutral.png"/>

<!-- Existing styles and icons -->
<link rel="stylesheet" href="style.css"/> <!-- Keep this for now, will remove later if Tailwind replaces all -->
<link rel="icon" type="image/x-icon" href="images/favicon.ico"/>

<!-- Tailwind CSS and Fonts from code.html -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3d84f5",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101722",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'OPSZ' 24; }
        .gauge-gradient {
            background: conic-gradient(from 180deg at 50% 100%, #f87171 0deg, #fbbf24 90deg, #3d84f5 180deg);
        }
    </style>

<!-- Existing Google Analytics and Clarity scripts -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C8QR98TVTB"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C8QR98TVTB');
    </script>

<script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "v2qmp0i82b");
    </script>

<!-- Existing ld+json -->
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "국내 금융시장 심리 알아보기",
      "url": "https://anse-sample1.pages.dev/korea-sentiment.html",
      "description": "한국 주식시장의 공포 탐욕 지수를 확인하고 투자에 참고하세요.",
      "datePublished": "2026-01-17",
      "author": {
        "@type": "Person",
        "name": "anse"
      }
    }
    </script>


</head>
<body>
<!-- Top Navigation Bar -->
<header class="sticky top-0 z-50 w-full border-b border-solid border-[#e7ecf4] dark:border-[#1e293b] bg-white/80 dark:bg-background-dark/80 backdrop-blur-md">
<div class="mx-auto flex max-w-[1200px] items-center justify-between px-6 py-3">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3">
<div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary">
<span class="material-symbols-outlined text-[20px] text-white">leaderboard</span>
</div>
<h2 class="text-lg font-bold tracking-tight dark:text-white">KOSPI Fear &amp; Greed</h2>
</div>
<nav class="hidden md:flex items-center gap-6">
<a class="text-sm font-semibold text-primary" href="/korea-sentiment.html">한국 금융시장 심리</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/index.html">오늘 저녁 뭐 먹지?</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/insect.html">곤충상 테스트</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/about-insect.html">곤충상이란?</a>
<a class="text-sm font-medium text-[#49699c] dark:text-slate-400 hover:text-primary transition-colors" href="/sentiment.html">미국 금융 시장 심리</a>
</nav>
</div>
<div class="flex items-center gap-4">

<button class="flex h-10 w-10 items-center justify-center rounded-lg bg-[#f0f3f9] dark:bg-slate-800 text-[#0d131c] dark:text-white">
<span class="material-symbols-outlined">notifications</span>
</button>
<div class="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/20" data-alt="User profile avatar" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBneBh9BK99BKx2b26Ln0wWAXSWA-NkKD-lrrv98lVK_rJdPXTgQuGmdvqczD3UIKISPcMnzpf-BQOdedWBnyulZOQWc1ciJwX7DT6PMhaFrVawJq4F6y18XmDN29W32bH_6CzaUWabwqtdTvTlUIGfSvw74jtRHl327xyGMcu_5I55ABKEDpKDaOoVeIFo8NUFPEGK3dONKg3bls3I7AJT26lh-N-OCbGYRo4N6cdwNSvECRXQfW82pZjHea9vnYNYvU8yp9ZTwnIf')"></div>
</div>
</div>
</header>
<main class="mx-auto max-w-[1200px] px-6 py-8">
<!-- Page Heading -->
<div class="mb-8 flex flex-wrap items-end justify-between gap-4">
<div class="flex flex-col gap-1">
<h1 class="text-3xl font-black tracking-tight dark:text-white">Market Sentiment Index</h1>
<p class="text-base text-[#49699c] dark:text-slate-400">KOSPI fear and greed analysis based on market momentum and volatility.</p>
</div>
<div id="market-status-indicator" class="flex items-center gap-2 rounded-full bg-emerald-100 dark:bg-emerald-900/30 px-3 py-1 text-xs font-bold text-emerald-600 dark:text-emerald-400">
<span id="market-status-dot" class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span id="market-status-text">MARKET OPEN</span>
            </div>
</div>
<div class="grid grid-cols-1 gap-8 lg:grid-cols-12">
<!-- Main Gauge Section -->
<div class="lg:col-span-8">
<div class="flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-8 shadow-sm">
<div class="mb-4 flex items-center justify-between">
<h3 class="text-lg font-bold">Current Sentiment</h3>
<span id="last-updated-time" class="text-sm font-medium text-[#49699c]">Last updated: 14:30 KST</span>
</div>
<div class="relative flex flex-col items-center py-10">
<!-- Gauge visualization -->
<div class="relative h-48 w-80 overflow-hidden rounded-t-full bg-slate-100 dark:bg-slate-800">
<!-- Gauge segments colored with conic gradient simulated as a semicircular background -->
<div class="absolute inset-0 gauge-gradient opacity-80" style="clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);"></div>
<div class="absolute bottom-0 left-1/2 h-32 w-64 -translate-x-1/2 rounded-t-full bg-white dark:bg-[#161f2c]"></div>
<!-- Needle -->
<div class="absolute bottom-0 left-1/2 h-40 w-1 -translate-x-1/2 origin-bottom transition-transform duration-1000 ease-out" id="gauge-needle" style="transform: translateX(-50%) rotate(54deg);">
<div class="h-full w-full bg-slate-900 dark:bg-white rounded-full"></div>
<div class="absolute -bottom-2 left-1/2 h-4 w-4 -translate-x-1/2 rounded-full bg-slate-900 dark:bg-white"></div>
</div>
</div>
<div class="mt-6 flex flex-col items-center gap-1">
<span id="score" class="text-5xl font-black text-primary">72</span>
<span id="status" class="text-2xl font-bold tracking-tight text-primary">GREED</span>
</div>
<div class="mt-10 flex w-full justify-between px-4">
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-red-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase">Extreme Fear</span>
</div>
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-yellow-400"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase">Neutral</span>
</div>
<div class="flex flex-col items-center gap-1">
<span class="h-1.5 w-12 rounded-full bg-primary"></span>
<span class="text-[10px] font-bold text-[#49699c] uppercase">Extreme Greed</span>
</div>
</div>
</div>
</div>
<!-- 30-Day Trend Chart -->
<div class="mt-8 flex flex-col overflow-hidden rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
<div class="mb-6 flex items-center justify-between">
<h3 class="text-lg font-bold">30-Day Index History</h3>
<div class="flex gap-2">
<button class="rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary">30D</button>
<button class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">90D</button>
<button class="rounded-md px-3 py-1 text-xs font-bold text-[#49699c] hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">1Y</button>
</div>
</div>
<div id="index-history-container" class="h-64 w-full relative"> <!-- Added ID and relative for absolute positioning -->
    <div id="chart-placeholder" class="absolute inset-0 flex items-center justify-center text-lg font-bold text-[#49699c]">
        Preparing data...
    </div>
    <div id="index-history-chart" class="h-full w-full" style="display: none;"> <!-- Added ID and initially hidden -->
        <svg class="h-full w-full" preserveaspectratio="none" viewbox="0 0 1000 200">
        <!-- Area background -->
        <path class="opacity-10" d="M0 160 Q 100 140, 200 150 T 400 120 T 600 80 T 800 100 T 1000 60 L 1000 200 L 0 200 Z" fill="url(#chartGradient)"></path>
        <!-- Line -->
        <path d="M0 160 Q 100 140, 200 150 T 400 120 T 600 80 T 800 100 T 1000 60" fill="none" stroke="#3d84f5" stroke-linecap="round" stroke-width="3"></path>
        <defs>
        <lineargradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="#3d84f5"></stop>
        <stop offset="100%" stop-color="#3d84f5" stop-opacity="0"></stop>
        </lineargradient>
        </defs>
        </svg>
        <div class="mt-4 flex justify-between text-[11px] font-bold text-[#49699c]">
        <span>30 DAYS AGO</span>
        <span>20 DAYS AGO</span>
        <span>10 DAYS AGO</span>
        <span>TODAY</span>
        </div>
    </div>
</div>
</div>
</div>
<!-- Historical Comparisons & Side Metrics -->
<div class="lg:col-span-4 flex flex-col gap-6">
<!-- Comparison Cards -->
<div class="grid grid-cols-1 gap-4">
<div class="flex flex-col gap-4 rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
    
    <div class="proverb-display">
        <h4 class="text-sm font-bold text-[#49699c] uppercase tracking-wider mb-4">오늘의 주식 시장 격언</h4>
        <p id="proverb-text" class="italic text-base text-gray-800 dark:text-gray-200 min-h-[50px] flex items-center justify-center text-center" style="white-space: pre-wrap;"></p>
        <button id="generate-proverb" class="mt-4 rounded-md bg-primary/10 px-3 py-1 text-xs font-bold text-primary hover:bg-primary/20 transition-colors">새 격언 확인하기</button>
    </div>
</div>
<!-- Market Indicators section -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-white dark:bg-[#161f2c] p-6 shadow-sm">
<h4 class="mb-4 text-sm font-bold text-[#49699c] uppercase tracking-wider">Market Indicators</h4>
<div class="space-y-4">
    <div class="flex flex-col gap-1">
    <div class="flex justify-between text-xs font-bold">
    <span>Stock Price Strength</span>
    <span class="text-primary">Very Strong</span>
    </div>
    <div class="h-1.5 w-full rounded-full bg-slate-100 dark:bg-slate-800">
    <div class="h-full w-[85%] rounded-full bg-primary"></div>
    </div>
    </div>
    <div class="flex flex-col gap-1">
    <div class="flex justify-between text-xs font-bold">
    <span>Market Volatility</span>
    <span class="text-emerald-500">Low</span>
    </div>
    <div class="h-1.5 w-full rounded-full bg-slate-100 dark:bg-slate-800">
    <div class="h-full w-[25%] rounded-full bg-emerald-500"></div>
    </div>
    </div>
    <div class="flex flex-col gap-1">
    <div class="flex justify-between text-xs font-bold">
    <span>Safe Haven Demand</span>
    <span class="text-red-400">Low</span>
    </div>
    <div class="h-1.5 w-full rounded-full bg-slate-100 dark:bg-slate-800">
    <div class="h-full w-[15%] rounded-full bg-red-400"></div>
    </div>
    </div>
    </div>
    </div>
    
<div id="indicator-details" class="space-y-4">
    <!-- Indicators will be injected here by JavaScript -->
    <p id="indicator-list" class="text-sm text-[#49699c] dark:text-slate-400"></p>
    <p id="indicator-avg" class="text-sm font-bold text-[#49699c] dark:text-slate-400"></p>
</div>
</div>
<!-- Market Indices Quick View -->
<div class="rounded-xl border border-[#e7ecf4] dark:border-[#1e293b] bg-primary text-white p-6 shadow-sm">
<div class="flex items-center justify-between mb-4">
<h4 class="text-sm font-bold uppercase tracking-wider">KOSPI</h4>
<a href="https://finance.naver.com/sise/" target="_blank"><span class="material-symbols-outlined">insights</span></a>
</div>
<div class="flex flex-col gap-1">
<p id="kospi200-value" class="text-3xl font-black">2,654.32</p>
<div class="flex items-center gap-2">
<span id="kospi200-change-rate" class="text-sm font-bold bg-white/20 px-2 py-0.5 rounded">+1.24%</span>
<span id="kospi200-change-point" class="text-sm text-white/80">▲ 32.50</span>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Footer / Data Source -->
<footer class="mt-12 border-t border-[#e7ecf4] dark:border-[#1e293b] pt-8 pb-12">
<div class="flex flex-wrap items-center justify-between gap-6 text-[#49699c] dark:text-slate-500">
<div class="flex flex-col gap-2">
<p class="text-sm font-medium">Data provided by KRX (Korea Exchange) and KOFIA.</p>
<p class="max-w-md text-xs leading-relaxed">The Fear &amp; Greed Index is a way to gauge stock market movements and whether stocks are fairly priced. The theory is based on the logic that excessive fear tends to drive down share prices, and too much greed tends to have the opposite effect.</p>
</div>
<div class="flex gap-4">
<button class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
<span class="material-symbols-outlined text-[18px]">help_outline</span>
                        How it's calculated
                    </button>
<button class="flex items-center gap-2 rounded-lg bg-[#e7ecf4] dark:bg-slate-800 px-4 py-2 text-sm font-bold text-[#0d131c] dark:text-white hover:opacity-80">
<span class="material-symbols-outlined text-[18px]">download</span>
                        Export Data
                    </button>
</div>
</div>
</footer>
</main>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      // Firebase initialization
      const firebaseConfig = {
        apiKey: "AIzaSyBumYJj1X1KrjwjWTZhGuO0B-xZJj1fLsE",
        authDomain: "anse-sample1-46739525-2d1c0.firebaseapp.com",
        projectId: "anse-sample1-46739525-2d1c0",
        storageBucket: "anse-sample1-46739525-2d1c0.firebasestorage.app",
        messagingSenderId: "164266713411",
        appId: "1:164266713411:web:31e470b1a7320aa6028ff6"
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.firestore();

        // Define indicator names
        const indicatorNames = {
            1: "시장의 모멘텀",
            2: "주가 강도",
            3: "시장의 폭",
            4: "시장 변동성",
            5: "옵션 풋콜 비율"
        };

        // Function to update gauge needle rotation and sentiment text/color
        function updateGauge(score) {
            const needle = document.getElementById('gauge-needle');
            const scoreDisplay = document.getElementById('score');
            const sentimentText = document.getElementById('status'); // Ref to sentiment text for color update

            // Map score 0-100 to rotation 0-180 degrees
            const rotationDegree = score * 1.8; // 180 / 100 = 1.8
            needle.style.transform = `translateX(-50%) rotate(${rotationDegree}deg)`;

            scoreDisplay.textContent = score;

            // Determine color based on score
            let textColorClass = "";
            if (score <= 25) { textColorClass = "text-red-500"; }
            else if (score <= 45) { textColorClass = "text-orange-500"; }
            else if (score <= 55) { textColorClass = "text-yellow-500"; }
            else if (score <= 75) { textColorClass = "text-emerald-500"; }
            else { textColorClass = "text-blue-500"; }
            
            // Apply color to score display
            scoreDisplay.className = scoreDisplay.className.split(' ').filter(c => !c.startsWith('text-')).join(' ');
            scoreDisplay.classList.add(textColorClass);
            
            // Apply color to sentiment text
            sentimentText.className = sentimentText.className.split(' ').filter(c => !c.startsWith('text-')).join(' ');
            sentimentText.classList.add(textColorClass);
        }

        async function fetchLatestIndex() {
            const scoreEl = document.getElementById('score');
            const statusEl = document.getElementById('status');
            const lastUpdatedTimeEl = document.getElementById('last-updated-time');
            const indicatorDetailsEl = document.getElementById('indicator-details');
            const indicatorListEl = document.getElementById('indicator-list');
            const indicatorAvgEl = document.getElementById('indicator-avg');

            // New elements for chart placeholder
            const chartPlaceholderEl = document.getElementById('chart-placeholder');
            const indexHistoryChartEl = document.getElementById('index-history-chart');
            
            // New elements for KOSPI 200 Quick View
            const kospi200ValueEl = document.getElementById('kospi200-value');
            const kospi200ChangeRateEl = document.getElementById('kospi200-change-rate');
            const kospi200ChangePointEl = document.getElementById('kospi200-change-point');

            // 로딩 상태 표시
            statusEl.textContent = "데이터를 불러오는 중..."; 
            if (indicatorDetailsEl) indicatorDetailsEl.style.display = 'none';
            if (chartPlaceholderEl) chartPlaceholderEl.style.display = 'flex'; // Show placeholder while loading
            if (indexHistoryChartEl) indexHistoryChartEl.style.display = 'none';

            // KOSPI 200 Quick View 로딩 상태
            kospi200ValueEl.textContent = "Loading...";
            kospi200ChangeRateEl.textContent = "";
            kospi200ChangePointEl.textContent = "";

            try {
                const q = db.collection("korea_index").orderBy("timestamp", "desc").limit(1);
                const querySnapshot = await q.get();

                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0].data();
                    const score = doc.score;
                    const statusFromFirestore = doc.status; // This will be the object
                    const timestamp = doc.timestamp.toDate(); // Corrected line
                    const formattedTime = timestamp.toLocaleString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
                    
                    // Update main score, sentiment, and gauge
                    updateGauge(score); // This handles needle and score color/value
                    lastUpdatedTimeEl.textContent = `Last updated: ${formattedTime}`; // Use template literal

                    // Set sentiment text from Firestore object
                    if (statusFromFirestore && statusFromFirestore.phase) {
                        statusEl.textContent = statusFromFirestore.phase;
                    } else {
                        statusEl.textContent = "업데이트된 데이터가 없습니다."; // Fallback if status object is missing
                    }

                    const indicators = [];
                    for (let i = 1; i <= 5; i++) {
                        const indicatorKey = `indicator${i}`;
                        if (doc[indicatorKey] !== undefined) {
                            indicators.push({
                                id: i,
                                name: indicatorNames[i],
                                value: doc[indicatorKey]
                            });
                        }
                    }

                    if (indicators.length > 0) {
                        const indicatorTexts = indicators.map(item => {
                            if (item.id === 5 && item.value === 50) {
                                return `지표 ${item.id}(${item.name}) : 준비중`;
                            } else if (item.value === 50) {
                                return `지표 ${item.id}(${item.name}) : 50 (수집 준비중, 현재는 평균값)`;
                            } else {
                                return `지표 ${item.id}(${item.name}) : ${item.value.toFixed(2)}`;
                            }
                        });
                        indicatorListEl.innerHTML = indicatorTexts.join('<br>');

                        const avg = indicators.reduce((a, b) => a + b.value, 0) / indicators.length;
                        indicatorAvgEl.textContent = `${indicators.length}개 지표 평균: ${avg.toFixed(2)}`;

                        indicatorDetailsEl.style.display = 'block';
                    } else {
                        indicatorDetailsEl.style.display = 'none'; // Hide if no indicators
                    }

                    // Chart data handling (placeholder for now)
                    // Assuming doc.historicalChartData will be available eventually
                    // For now, it will always show "Preparing data..."
                    if (doc.historicalChartData) { // Placeholder condition for future chart data
                        chartPlaceholderEl.style.display = 'none';
                        indexHistoryChartEl.style.display = 'block';
                        // Render chart here when data is available
                    } else {
                        chartPlaceholderEl.style.display = 'flex'; // Use flex for centering
                        indexHistoryChartEl.style.display = 'none';
                    }

                    // Fetch KOSPI 200 data from Yahoo Finance (client-client, might be flaky)
                    try {
                        const response = await fetch('https://query1.finance.yahoo.com/v7/finance/download/^KS200?period1=1609459200&period2=' + Math.floor(Date.now() / 1000) + '&interval=1d&events=history');
                        const text = await response.text();
                        const lines = text.split('\n');
                        
                        // Find the last two valid data lines
                        let latestDataLine = null;
                        let previousDataLine = null;
                        for (let i = lines.length - 2; i > 0; i--) { // Start from second to last line
                            const line = lines[i];
                            if (line.trim().length > 0 && !line.startsWith('Date')) {
                                if (latestDataLine === null) {
                                    latestDataLine = line;
                                } else if (previousDataLine === null) {
                                    previousDataLine = line;
                                    break;
                                }
                            }
                        }

                        if (latestDataLine && previousDataLine) {
                            const latestData = latestDataLine.split(',');
                            const previousData = previousDataLine.split(',');

                            const currentClose = parseFloat(latestData[4]); // Close price
                            const previousClose = parseFloat(previousData[4]);

                            if (!isNaN(currentClose) && !isNaN(previousClose)) {
                                const change = currentClose - previousClose;
                                const changeRate = (change / previousClose) * 100;

                                kospi200ValueEl.textContent = currentClose.toFixed(2);
                                kospi200ChangeRateEl.textContent = `${changeRate.toFixed(2)}%`;
                                kospi200ChangePointEl.textContent = `${change > 0 ? '▲' : '▼'} ${Math.abs(change).toFixed(2)}`;

                                // Apply color for change
                                // Remove existing color classes first
                                kospi200ChangeRateEl.classList.remove('bg-emerald-500/20', 'bg-red-500/20', 'bg-white/20');
                                kospi200ChangePointEl.classList.remove('text-emerald-500/80', 'text-red-500/80', 'text-white/80');

                                if (change > 0) {
                                    kospi200ChangeRateEl.classList.add('bg-emerald-500/20');
                                    kospi200ChangePointEl.classList.add('text-emerald-500/80');
                                } else if (change < 0) {
                                    kospi200ChangeRateEl.classList.add('bg-red-500/20');
                                    kospi200ChangePointEl.classList.add('text-red-500/80');
                                } else {
                                    kospi200ChangeRateEl.classList.add('bg-white/20'); // Neutral color
                                    kospi200ChangePointEl.classList.add('text-white/80'); // Neutral color
                                }
                            } else {
                                throw new Error("Invalid KOSPI 200 numerical data.");
                            }
                        } else {
                            throw new Error("KOSPI 200 data not found in response.");
                        }
                    } catch (kospiError) {
                        console.error("Failed to fetch KOSPI 200 data from Yahoo Finance:", kospiError);
                        kospi200ValueEl.textContent = "N/A";
                        kospi200ChangeRateEl.textContent = "N/A";
                        kospi200ChangePointEl.textContent = "N/A";
                    }

                } else {
                    statusEl.textContent = "업데이트된 데이터가 없습니다.";
                    if (indicatorDetailsEl) indicatorDetailsEl.style.display = 'none';
                    if (chartPlaceholderEl) chartPlaceholderEl.style.display = 'flex'; // Show placeholder if no data
                    if (indexHistoryChartEl) indexHistoryChartEl.style.display = 'none';
                    kospi200ValueEl.textContent = "N/A";
                    kospi200ChangeRateEl.textContent = "N/A";
                    kospi200ChangePointEl.textContent = "N/A";
                }
            } catch (error) {
                console.error("Firebase 오류: ", error);
                statusEl.textContent = "연결 오류가 발생했습니다.";
                if (indicatorDetailsEl) indicatorDetailsEl.style.display = 'none';
                if (chartPlaceholderEl) chartPlaceholderEl.style.display = 'flex'; // Show placeholder on error
                if (indexHistoryChartEl) indexHistoryChartEl.style.display = 'none';
                kospi200ValueEl.textContent = "N/A";
                kospi200ChangeRateEl.textContent = "N/A";
                kospi200ChangePointEl.textContent = "N/A";
            } finally {
                // Main score, sentiment, and last updated time are always displayed
                scoreEl.style.display = 'block';
                statusEl.style.display = 'block';
                lastUpdatedTimeEl.style.display = 'block';
            }
        }

        const proverbs = [
        "“시장은 단기적으로 투표기계지만 장기적으로 저울이다.”\n→ 벤저민 그레이엄 (Benjamin Graham)",
        "“잃지 않는 것이 버는 것보다 중요하다.”\n→ 워런 버핏 (Warren Buffett)",
        "“첫 번째 규칙은 돈을 잃지 않는 것이다. 두 번째 규칙은 첫 번째 규칙을 잊지 않는 것이다.”\n→ 워런 버핏",
        "“훌륭한 기업을 적당한 가격에 사라.”\n→ 워런 버핏 / 찰리 멍거",
        "“위험은 자신이 무엇을 하고 있는지 모를 때 생긴다.”\n→ 워런 버핏",
        "“공포 속에서 사고 탐욕 속에서 팔아라.”\n→ 워런 버핏 / 월가 격언",
        "“시장은 인내심 없는 사람의 돈을 인내심 있는 사람에게서 옮겨준다.”\n→ 워런 버핏",
        "“가격은 지불하는 것이고 가치는 얻는 것이다.”\n→ 워런 버핏",
        "“이해하지 못하는 사업에는 투자하지 마라.”\n→ 워런 버핏",
        "“10년 이상 보유할 생각이 없다면 10분도 보유하지 마라.”\n→ 워런 버핏",
        "“추세는 당신의 친구다.”\n→ 제시 리버모어 (Jesse Livermore)",
        "“손실은 짧게, 이익은 길게 가져가라.”\n→ 제시 리버모어",
        "“시장은 항상 옳다.”\n→ 제시 리버모어 (의미상 격언)",
        "“강세장은 비관 속에서 태어나 회의 속에서 자라고 낙관 속에서 성숙하며 도취 속에서 죽는다.”\n→ 존 템플턴 (John Templeton)",
        "“이번엔 다르다는 말이 가장 위험하다.”\n→ 존 템플턴",
        "“기다리는 것도 포지션이다.”\n→ 월가 격언",
        "“현금도 투자다.”\n→ 월가 격언",
        "“절대 바닥에서 못 사고 꼭대기에서 못 판다.”\n→ 월가 격언",
        "“칼 떨어질 때 잡지 마라.”\n→ 월가 격언",
        "“소문에 사고 뉴스에 팔아라.”\n→ 월가 격언",
        "“모두가 같은 방향을 볼 때 위험은 커진다.”\n→ 월가 격언",
        "“시장은 당신의 감정을 시험한다.”\n→ 월가 격언",
        "“확신이 클수록 조심하라.”\n→ 월가 격언",
        "“거래가 잦을수록 수익률은 낮아진다.”\n→ 브래드 바버 & 테런스 오딘 (행동재무학 연구)",
        "“시장에 머무는 시간이 시장을 맞추는 것보다 중요하다.”\n→ 투자 격언 (Bogle 계열 인용)",
        "“복리는 세계 8대 불가사의다.”\n→ 알버트 아인슈타인 (투자 격언으로 인용)",
        "“시간은 좋은 기업의 편이다.”\n→ 워런 버핏",
        "“숫자를 보지 않고 주식을 사는 것은 계기판 없는 비행기를 타는 것과 같다.”\n→ 피터 린치 (Peter Lynch)",
        "“스토리가 아니라 실적을 사라.”\n→ 피터 린치 (의미 요약)",
        "“가장 위험한 시점은 모두가 안심할 때다.”\n→ 하워드 막스 (Howard Marks)",
        "“리스크는 변동성이 아니라 영구적 자본 손실이다.”\n→ 하워드 막스",
        "“좋은 투자란 나쁜 시나리오에서도 버티는 것이다.”\n→ 하워드 막스",
        "“높은 수익은 높은 불편함에서 나온다.”\n→ 하워드 막스",
        "“시장은 과잉 반응한다.”\n→ 로버트 실러 (Robert Shiller)",
        "“분산투자는 무지를 인정하는 행위다.”\n→ 워런 버핏",
        "“가장 좋은 매수 시점은 모두가 팔고 싶을 때다.”\n→ 월가 격언",
        "“싸게 사는 것이 수익의 절반이다.”\n→ 벤저민 그레이엄",
        "“시장은 언제나 과도하게 낙관적이거나 비관적이다.”\n→ 벤저민 그레이엄",
        "“손절은 선택이 아니라 생존이다.”\n→ 트레이더 격언",
        "“포트폴리오는 수익이 아니라 리스크로 관리하라.”\n→ 레이 달리오 (Ray Dalio)",
        "“미래를 예측하지 말고 대비하라.”\n→ 레이 달리오",
        "“좋은 투자자는 예측보다 원칙에 의존한다.”\n→ 레이 달리오",
        "“시장은 합리적이지 않을 수 있다, 하지만 오래 비합리적이진 않다.”\n→ 존 메이너드 케인즈 (John M. Keynes)",
        "“시장은 당신이 파산하기 전에 비이성적으로 남아 있을 수 있다.”\n→ 존 메이너드 케인즈",
        "“레버리지는 실수를 치명적으로 만든다.”\n→ 월가 격언",
        "“수익은 인내에서 나오고 손실은 조급함에서 나온다.”\n→ 월가 격언",
        "“완벽한 타이밍은 없다.”\n→ 투자 격언",
        "“하락장은 나쁜 기업을 드러낸다.”\n→ 월가 격언",
        "“좋은 기업은 위기에서 더 강해진다.”\n→ 워런 버핏 (의미 인용)",
        "“투자에서 가장 중요한 단어는 ‘영원히’가 아니라 ‘충분히 오래’다.”\n→ 하워드 막스 (의미 인용)"
        ];

        function displayRandomProverb() {
            const proverbText = document.getElementById('proverb-text');
            if (proverbText) { // Check if element exists before updating
                const randomIndex = Math.floor(Math.random() * proverbs.length);
                const selectedProverb = proverbs[randomIndex];
                proverbText.textContent = selectedProverb;
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await fetchLatestIndex(); // Call fetchLatestIndex first
            displayRandomProverb(); // Then display proverb
            const generateProverbButton = document.getElementById('generate-proverb');
            if (generateProverbButton) {
                generateProverbButton.addEventListener('click', displayRandomProverb); // Set up button listener
            }
        });
    </script>

</body>
</html>